<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Fri Dec 20 16:02:16 2002            -->
<!--                                             -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>PAFReader - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, windows, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//                                                                      //</b>
<b>// <a href=".././PAFReader.html">PAFReader</a>								//</b>
<b>//                                                                      //</b>
<b>// Base class of the PAF event reader classes				//</b>
<b>//                                                                      //</b>
<b>// Author: Marcel Kunze, RUB, May 2000					//</b>
<b>// Copyright (C) 1999-2001, Ruhr-University Bochum.			//</b>
<b>//									//</b>
<b>//////////////////////////////////////////////////////////////////////////</b>

#include "TNamed.h"
#include "THashList.h"
#include "TClonesArray.h"
#include "TList.h"
#include "TNode.h"
#include "TSPHE.h"
#include "TMaterial.h"
#include "TTreeFormula.h"

<b>// PAF includes</b>

#include "PAFSchema/PAFReader.h"
#include "PAFSchema/PAFStream.h"
#include "RhoBase/TRho.h"
#include "PAFSchema/PAFMcTruth.h"
#include "RhoBase/TCandList.h"
#include "RhoBase/TCandidate.h"
#include "RhoTools/TPrintTree.h"
#include "RhoBase/VAbsMicroCandidate.h"
#include "RhoBase/VAbsBit.h"
#include "PAFSchema/PAFEventBase.h"
#include "PAFSchema/PAFBitBase.h"
#include "PAFSchema/PAFMcBase.h"
#include "PAFSchema/PAFListBase.h"
#include "RhoBase/TSmartPointer.h"

ClassImp(PAFReader)

#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
using namespace std;

<b>// Implementation of the <a href=".././PAFReader.html">PAFReader</a> base class</b>

<a name="PAFReader:PAFReader"> </a><a href=".././PAFReader.html#PAFReader:PAFReader">PAFReader::PAFReader</a>(const <a href="../ListOfTypes.html#char">char</a> *file, const <a href="../ListOfTypes.html#char">char</a> * description) :
VAbsReader(file,description),
<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>(0),            // created only on purpose in <a href="#PAFReader:FillMcTruthList">FillMcTruthList</a>()
<a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a>(-1),
<a href=".././PAFReader.html#PAFReader:fBtaCandAssocMap">fBtaCandAssocMap</a>(0),
<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fEidStream">fEidStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fCmpStream">fCmpStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fTruStream">fTruStream</a>(0),
<a href=".././PAFReader.html#PAFReader:fCounter">fCounter</a>(-1),
<a href=".././PAFReader.html#PAFReader:fTotal">fTotal</a>(0),
<a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>(new THashList),
<a href=".././PAFReader.html#PAFReader:fTag">fTag</a>(kTRUE),
<a href=".././PAFReader.html#PAFReader:fAod">fAod</a>(kTRUE),
<a href=".././PAFReader.html#PAFReader:fMap">fMap</a>(kFALSE),
<a href=".././PAFReader.html#PAFReader:fCmp">fCmp</a>(kFALSE),
<a href=".././PAFReader.html#PAFReader:fMct">fMct</a>(kFALSE),
<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>(0),
<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>(0),
<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>(kFALSE),
<a href=".././PAFReader.html#PAFReader:fPrintTree">fPrintTree</a>()
{
    <a href=".././PAFReader.html#PAFReader:fTagExpr">fTagExpr</a> = TString("");
    <a href=".././PAFReader.html#PAFReader:fBitExpr">fBitExpr</a> = TString("");
    <a href=".././PAFReader.html#PAFReader:fContent">fContent</a> = new <a href=".././PAFEventBase.html">PAFEventBase</a>();
    <a href=".././PAFReader.html#PAFReader:fBits">fBits</a>    = new <a href=".././PAFBitBase.html">PAFBitBase</a>();
    <a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fBtaList">fBtaList</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fMaxC">fMaxC</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fMaxN">fMaxN</a> = 0;
    
    <a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a> = new TClonesArray("<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>");
    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a> = 0;
}

<a name="PAFReader:~PAFReader"> </a><a href=".././PAFReader.html">PAFReader</a>::~<a href=".././PAFReader.html">PAFReader</a>( ) 
{    
    delete <a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>;
    delete <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>;
    delete <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>;

    delete <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>; 
    delete <a href=".././PAFReader.html#PAFReader:fBits">fBits</a>;
    delete <a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>;
    delete <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>;
    delete <a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>;
    delete <a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>;
    delete <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a>;
    delete <a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a>;
    delete <a href=".././PAFReader.html#PAFReader:fBtaList">fBtaList</a>;

<b>    // Close all connected files</b>
    TIter iter(<a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>);
    <a href=".././PAFStream.html">PAFStream</a> *s = 0;
    while (s = (<a href=".././PAFStream.html">PAFStream</a> *) iter.Next()) {
	if (s-&gt;GetFile()) s-&gt;GetFile()-&gt;Close();
    }
    
    <a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>-&gt;Delete(); delete <a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>;
}

<a name="PAFReader:SetTagFormula"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:SetTagFormula">PAFReader::SetTagFormula</a>(const <a href="../ListOfTypes.html#char">char</a>* formula)
{
    TString tagExpr(formula);
    <a href=".././PAFReader.html#PAFReader:fTagExpr">fTagExpr</a> = tagExpr;
    <a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a> = tagExpr.ReplaceAll("TAG_i","_tag.");
    <a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a> = <a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a>.ReplaceAll("TAG_f","_tag.");
    if (<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>!=0) { delete <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>; <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>=0; }
    <a href="#PAFReader:InitTagBranches">InitTagBranches</a>(<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
}

<a name="PAFReader:SetBitFormula"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:SetBitFormula">PAFReader::SetBitFormula</a>(const <a href="../ListOfTypes.html#char">char</a>* formula)
{
    TString bitExpr(formula);
    <a href=".././PAFReader.html#PAFReader:fBitExpr">fBitExpr</a> = bitExpr;
    if (<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>!=0) { delete <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>; <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>=0; }
    <a href="#PAFReader:InitBitBranches">InitBitBranches</a>(<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
}

<a name="PAFReader:EvalTagFormula"> </a><a href="../ListOfTypes.html#Double_t">Double_t</a> <a href=".././PAFReader.html#PAFReader:EvalTagFormula">PAFReader::EvalTagFormula</a>()
{
    if (!<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>) { return -1; }
    for (<a href="../ListOfTypes.html#Int_t">Int_t</a> i=0; i&lt;<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>-&gt;GetNcodes(); i++) {
	<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>-&gt;GetLeaf(i)-&gt;GetBranch()-&gt;GetEntry(<a href=".././PAFReader.html#PAFReader:fCounter">fCounter</a>);
    }
    return <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>-&gt;EvalInstance(99999);
}

<a name="PAFReader:EvalBitFormula"> </a><a href="../ListOfTypes.html#Double_t">Double_t</a> <a href=".././PAFReader.html#PAFReader:EvalBitFormula">PAFReader::EvalBitFormula</a>()
{
    if (!<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>) { return -1; }
    for (<a href="../ListOfTypes.html#Int_t">Int_t</a> i=0; i&lt;<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>-&gt;GetNcodes(); i++) {
	<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>-&gt;GetLeaf(i)-&gt;GetBranch()-&gt;GetEntry(<a href=".././PAFReader.html#PAFReader:fCounter">fCounter</a>);
    }
    return <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>-&gt;EvalInstance(99999);
}

<a href="../ListOfTypes.html#UInt_t">UInt_t</a>
<a name="PAFReader:GetCurrentIndex"> </a><a href=".././PAFReader.html#PAFReader:GetCurrentIndex">PAFReader::GetCurrentIndex</a>() 
{
    return <a href=".././PAFReader.html#PAFReader:fCounter">fCounter</a>;
}

<a name="PAFReader:NewStream"> </a><a href=".././PAFStream.html">PAFStream</a>* <a href=".././PAFReader.html#PAFReader:NewStream">PAFReader::NewStream</a>(const <a href="../ListOfTypes.html#char">char</a>* AFileNameBase, const <a href="../ListOfTypes.html#char">char</a>* ATreeName)
{
    <a href=".././PAFStream.html">PAFStream</a> *s= new <a href=".././PAFStream.html">PAFStream</a>(AFileNameBase,ATreeName);  
    <a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>-&gt;Add(s);
    return s;
}

<a name="PAFReader:GetStream"> </a><a href=".././PAFStream.html">PAFStream</a>* <a href=".././PAFReader.html#PAFReader:GetStream">PAFReader::GetStream</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> StreamNo)
{
    return (<a href=".././PAFStream.html">PAFStream</a>*)<a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>-&gt;At(StreamNo);
}

<a name="PAFReader:GetNumberOfEventsProcessed"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfEventsProcessed">PAFReader::GetNumberOfEventsProcessed</a>() const 
{
<b>    // Return the number of events currently processed</b>
    return <a href=".././PAFReader.html#PAFReader:fTotal">fTotal</a>;
}

<b>// __________________________________</b>
<b>// Read a specific Event from Streams</b>
<b>// __________________________________</b>

<a name="PAFReader:GetEvent"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:GetEvent">PAFReader::GetEvent</a>(<a href="../ListOfTypes.html#UInt_t">UInt_t</a> number) 
{
<b>    // Tell the Streams to read next event; they </b>
<b>    // know themselves whether they are "on" or "off"</b>
    
<b>    // Check if we reached the end of file</b>
    
    if (<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>!=0 &amp;&amp; <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:IsActive">IsActive</a>())
	if (number&gt;=<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>()-&gt;GetEntries()) return 0;
	
	<a href=".././PAFReader.html#PAFReader:fCounter">fCounter</a> = number; // Note the actual event
	<a href="../ListOfTypes.html#Int_t">Int_t</a> nbytes = 1;
	
<b>	// It is enough for the tag and bit to set the event number</b>
<b>	// In case of a request, the corresponding branch is switched on</b>
<b>	// and the entry is read from the tree.</b>
	<a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:SetOtherEventNumber">SetOtherEventNumber</a>(number);
	<a href=".././PAFReader.html#PAFReader:fBits">fBits</a>-&gt;SetEventNumber(number);
	TSmartPointer::SetEventNumber(number);
	
	TIter iter(<a href=".././PAFReader.html#PAFReader:fStreams">fStreams</a>);
	<a href=".././PAFStream.html">PAFStream</a> *s = 0;
	while (s = (<a href=".././PAFStream.html">PAFStream</a> *) iter.Next()) {
	    if (s==<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>) continue; // Do not read this
	    if (!s-&gt;IsActive()) continue; // Do not read this
	    <a href="../ListOfTypes.html#Int_t">Int_t</a> n = s-&gt;<a href="#PAFReader:GetEvent">GetEvent</a>(number);	
	    if (n&lt;0) return 0; // Check the end
	    nbytes += n;
	}
	
	<a href=".././PAFReader.html#PAFReader:fTotal">fTotal</a>++;
	
	return nbytes;
}

<a name="PAFReader:GetMcTruth"> </a>VAbsTruth&amp; <a href=".././PAFReader.html#PAFReader:GetMcTruth">PAFReader::GetMcTruth</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> n)
{
<b>    // Provide access to McTruth Objects by index</b>
    <a href="#PAFReader:CreateMcTruthList">CreateMcTruthList</a>();
    
    if ( n&lt;0 || n&gt;=<a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a> ) {
<b>	// correct would be: throw range_error;  no exceptions in PAF,  bummer ;(</b>
<b>	// memory leaking due to frustration</b>
	cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:GetMcTruth">PAFReader::GetMcTruth</a>:  Index out of Bounds index:"&lt;&lt;n&lt;&lt;" max: "&lt;&lt;<a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a>-1&lt;&lt; endl;
	return (*(new <a href=".././PAFMcTruth.html">PAFMcTruth</a>()));  
    }
    return *(VAbsTruth*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[n];
}

<a name="PAFReader:CreateMcTruthList"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:CreateMcTruthList">PAFReader::CreateMcTruthList</a>()
{
<b>    // Regenerate cache in case of a need</b>
    static <a href="../ListOfTypes.html#Int_t">Int_t</a> oldEvent = -1;
    if (<a href="#PAFReader:GetEventNumber">GetEventNumber</a>() == oldEvent) return;
    oldEvent = <a href="#PAFReader:GetEventNumber">GetEventNumber</a>();
    
<b>    //    Ceate the TClonesArray of <a href=".././PAFMcTruth.html">PAFMcTruth</a> objects from an existing TCl.Arr. from PAFMcBases in <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a>.</b>
    if (!<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>) <a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a> = new TClonesArray("<a href=".././PAFMcTruth.html">PAFMcTruth</a>");
    <a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>-&gt;Delete();  // <a href=".././PAFMcTruth.html">PAFMcTruth</a> owns a ObjArray with pointers to daughters. Maybe I shouldn't use a ClonesArray at all, no speed gain when deleting every time.
    <a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a> = <a href="#PAFReader:GetNumberOfMcTruthTracks">GetNumberOfMcTruthTracks</a>();
    if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:CreateMcTruthList">PAFReader::CreateMcTruthList</a> :  MctTracks: #" &lt;&lt; <a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a> &lt;&lt; endl;
    <a href="../ListOfTypes.html#Int_t">Int_t</a> firstMother = -1;
    for (<a href="../ListOfTypes.html#int">int</a> i=0;i&lt;<a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a>;++i) { 
	<a href=".././PAFMcBase.html">PAFMcBase</a>&amp; mcbase = <a href="#PAFReader:GetMcBase">GetMcBase</a>(i);
	new ( (*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[i] ) <a href=".././PAFMcTruth.html">PAFMcTruth</a>( mcbase );
	<a href=".././PAFMcTruth.html">PAFMcTruth</a> &amp;mc = *(<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[i];
<b>	// the next line works because the indices are equal in <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a> and fMcTruthEntries</b>
	<a href="../ListOfTypes.html#int">int</a> iBaseMother = mcbase.GetMother();
	if ( iBaseMother&gt;=0 ) {
	    if (firstMother&lt;0) firstMother = iBaseMother;
	    ((<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[i])-&gt;SetMother(  (<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[ iBaseMother ] );
	    ((<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[iBaseMother])-&gt;AddDaughter( (<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[i] );
	}
    }

    if (<a href=".././PAFReader.html#PAFReader:fPrintTree">fPrintTree</a> &amp;&amp; firstMother!=-1) {
	const <a href=".././PAFMcTruth.html">PAFMcTruth</a> &amp;mother = *(<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[firstMother];
	cout &lt;&lt; (<a href=".././PAFReader.html#PAFReader:fPrintTree">fPrintTree</a>-&gt;<a href=".././TPrintTree.html#TPrintTree:Print">Print</a>(mother)).Data() &lt;&lt; endl;
    }
    
}

<a name="PAFReader:FillCanonicalMcTruthList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:FillCanonicalMcTruthList">PAFReader::FillCanonicalMcTruthList</a>(TCandList *aList)
{
<b>    // Fill a list of McTruth candidates in canonical form (vertical trees)</b>
<b>    // This format is necessary to run e.g. the BABAR associators</b>
<b>    // 1) Fill a list of candidates in StdHep order</b>
<b>    // 2) Do a inversion based on TNodes (canonical representation)</b>
<b>    // 3) Construct a corresponding candidate list</b>

    if ( !aList ) { cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:FillCanonicalMcTruthList">PAFReader::FillCanonicalMcTruthList</a>: Try to fill non-existant list" &lt;&lt; endl; return 0; }
    
    aList-&gt;Reset();
    static TCandList truthList;
    if (<a href="#PAFReader:FillMcTruthList">FillMcTruthList</a>(&amp;truthList)==0) return 0;
    static TList mcList;
    mcList.Delete();
    <a href="#PAFReader:LoadMcNodes">LoadMcNodes</a>(&amp;mcList);
    <a href="../ListOfTypes.html#Int_t">Int_t</a> entries = mcList.GetSize();
    for (<a href="../ListOfTypes.html#int">int</a> m=0;m&lt;entries;m++) {
      <a href="../ListOfTypes.html#Int_t">Int_t</a> id = mcList.At(m)-&gt;GetUniqueID();
      const TCandidate *c = truthList.Get(id);
      aList-&gt;Add(*c);
    }

    return entries;
}

<a name="PAFReader:FillMcTruthList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:FillMcTruthList">PAFReader::FillMcTruthList</a>(TCandList *aList)
{
<b>    // The TCandList aList is filled with TCandidates with valid MCTruth Pointers.</b>
<b>    // The McTruth Pointers point to a <a href=".././PAFMcTruth.html">PAFMcTruth</a> Object that is owned by the EventManager.</b>
<b>    // It is more or less a mirror of the TClonesArray of McBases, but pointer linked.</b>
    
    if ( !aList ) { cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:FillMcTruthList">PAFReader::FillMcTruthList</a>: Try to fill non-existant list" &lt;&lt; endl; return 0; }
    
    <a href="#PAFReader:CreateMcTruthList">CreateMcTruthList</a>();

    <a href="../ListOfTypes.html#Float_t">Float_t</a> *bestMatch = new <a href="../ListOfTypes.html#float">float</a>[<a href="#PAFReader:GetNumberOfCandidates">GetNumberOfCandidates</a>()];
    for (<a href="../ListOfTypes.html#int">int</a> n=0;n&lt;<a href="#PAFReader:GetNumberOfCandidates">GetNumberOfCandidates</a>();n++)  bestMatch[n] = 0.0;

<b>    // Filll aList with TCandidates from PAFMcTruthList</b>
    aList-&gt;Cleanup();
    for (<a href="../ListOfTypes.html#int">int</a> i=0;i&lt;<a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a>;++i) {
	<a href=".././PAFMcTruth.html">PAFMcTruth</a> *mcTruth = (<a href=".././PAFMcTruth.html">PAFMcTruth</a>*)(*<a href=".././PAFReader.html#PAFReader:fPAFMcTruthList">fPAFMcTruthList</a>)[i];
	aList-&gt;Put(TCandidate(*mcTruth,i));
	TCandidate *cand = aList-&gt;Get(i);
	<a href="../ListOfTypes.html#Int_t">Int_t</a> index = mcTruth-&gt;GetAodMatchIndex();
	<a href="../ListOfTypes.html#Double_t">Double_t</a> consistency = mcTruth-&gt;GetAodMatchConsistency();
	if (index&gt;=0 &amp;&amp; index&lt;<a href="#PAFReader:GetNumberOfCandidates">GetNumberOfCandidates</a>()) {
	    VAbsMicroCandidate &amp;micro = <a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(index);
	    if (consistency&gt;bestMatch[index]) { // Found a better match
	      bestMatch[index] = consistency;
	      micro.SetMcPid(cand-&gt;PdtEntry()-&gt;PdgCode());
	      micro.SetMcConsistency(consistency);
	      micro.SetMcIndex(i);
	      cand-&gt;SetMicroCandidate(micro);
	      if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) cout &lt;&lt; "MCBase#" &lt;&lt; i &lt;&lt; "-&gt;Micro#" &lt;&lt; index &lt;&lt; " " &lt;&lt; consistency &lt;&lt; " "&lt;&lt; TRho::Instance()-&gt;GetPDG()-&gt;GetParticle(micro.GetMcPid())-&gt;GetName() &lt;&lt; endl;
	    }
	}
    }

    delete bestMatch;
    return <a href=".././PAFReader.html#PAFReader:fPAFMcTruthEntries">fPAFMcTruthEntries</a>;
}

<a href="../ListOfTypes.html#void">void</a> 
<a name="PAFReader:LoadMcNodes"> </a><a href=".././PAFReader.html#PAFReader:LoadMcNodes">PAFReader::LoadMcNodes</a>( TList* mcList)
{
    <a href="#PAFReader:CreateMcTruthList">CreateMcTruthList</a>(); // Make sure the MCTruth is present
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nmc = <a href="#PAFReader:GetNumberOfMcTruthTracks">GetNumberOfMcTruthTracks</a>();
    if (nmc&gt;NMCMAX) {
	cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:LoadMcNodes">PAFReader::LoadMcNodes</a>: nmc&gt;" &lt;&lt; NMCMAX &lt;&lt; endl;
	return;
    }

    TList list;
    
    for(<a href="../ListOfTypes.html#int">int</a> j=0; j&lt;nmc; j++ ) <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[j]=kTRUE;

    for(<a href="../ListOfTypes.html#int">int</a> i=0; i&lt;nmc; i++ )
    {
<b>	// Check STDHEP_INCOMING</b>
	if ( <a href="#PAFReader:GetMcTruth">GetMcTruth</a>(i).GetStatus()==3) { <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[i]=kFALSE; continue;}
	if ( <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[i]==kFALSE ) continue;

	TNode* cand=0;   
	
	if( !<a href="#PAFReader:MakeNodeFromStdTrack">MakeNodeFromStdTrack</a>( i, cand ) )
	{
	    cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:LoadMcNodes">PAFReader::LoadMcNodes</a>: No TNode built for this StdHep entry ";
	    cerr &lt;&lt; endl;
	    <a href="#PAFReader:GetMcTruth">GetMcTruth</a>(i).PrintOn( cerr );
	    cerr &lt;&lt; endl;
	    continue;
	}
	
<b>	// add the candidate to the temporary list</b>
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:LoadMcNodes">PAFReader::LoadMcNodes</a>: Add node " &lt;&lt; cand-&gt;GetName() &lt;&lt; endl;
	list.Add( cand );
    }

<b>    // now iterate on the temporary list</b>
    TListIter iterList( &amp;list );
    TNode* cand=0;
    while( cand=(TNode*)iterList.Next() )
    {
	<a href="#PAFReader:FillMcList">FillMcList</a>( *mcList, *cand );
    }

}

<a href="../ListOfTypes.html#void">void</a>
<a name="PAFReader:PrintMcList"> </a><a href=".././PAFReader.html#PAFReader:PrintMcList">PAFReader::PrintMcList</a>(TNode&amp; node)
{
    static <a href="../ListOfTypes.html#Int_t">Int_t</a> tab = 0;
    for (<a href="../ListOfTypes.html#int">int</a> i=0; i&lt;tab; i++) cout &lt;&lt; " ";
    cout &lt;&lt; node.GetName() &lt;&lt; " " &lt;&lt; node.GetUniqueID() &lt;&lt; endl;
    TList *dauList = node.GetListOfNodes();
    if (dauList!=0) {
      tab += 2;
      for (<a href="../ListOfTypes.html#int">int</a> j=0; j&lt;tab; j++) cout &lt;&lt; " ";
      cout &lt;&lt; "{ " &lt;&lt; dauList-&gt;GetSize() &lt;&lt; " daughters" &lt;&lt; endl;
      TListIter iter(dauList);
      TNode* dau=0;
      while( dau=(TNode*)iter.Next() )
      {
	<a href="#PAFReader:PrintMcList">PrintMcList</a>(*dau );
      }
      for (<a href="../ListOfTypes.html#int">int</a> k=0; k&lt;tab; k++) cout &lt;&lt; " ";
      cout &lt;&lt; "}" &lt;&lt; endl;
      tab -= 2;
    }
}

<a href="../ListOfTypes.html#void">void</a>
<a name="PAFReader:FillMcList"> </a><a href=".././PAFReader.html#PAFReader:FillMcList">PAFReader::FillMcList</a>( TList&amp; list, TNode&amp; cand )
{
    if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:FillMcList">PAFReader::FillMcList</a>: Add to mcList " &lt;&lt; cand.GetName();
	cout &lt;&lt; " index=" &lt;&lt; cand.GetUniqueID() &lt;&lt; endl;
    }
    list.Add( (TObject*)&amp;cand );
    TList *dauList = cand.GetListOfNodes();
    if (dauList!=0) {
	if (dauList-&gt;GetSize()==0) return;
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	    cout &lt;&lt; " dau=" &lt;&lt; dauList-&gt;GetSize();
	    for (<a href="../ListOfTypes.html#int">int</a> i=0;i&lt;dauList-&gt;GetSize();i++) cout &lt;&lt; " " &lt;&lt; dauList-&gt;At(i)-&gt;GetName();
	    cout &lt;&lt; endl;
	}
	TListIter iter(dauList);
	TNode* dau=0;
	while( dau=(TNode*)iter.Next() )
	{
	    <a href="#PAFReader:FillMcList">FillMcList</a>( list, *dau );
	}
    }
}

<a href="../ListOfTypes.html#Bool_t">Bool_t</a>
<a name="PAFReader:MakeNodeFromStdTrack"> </a><a href=".././PAFReader.html#PAFReader:MakeNodeFromStdTrack">PAFReader::MakeNodeFromStdTrack</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i, TNode*&amp; mother )
{
    if (mother!=0) mother-&gt;cd();

    TDatabasePDG *pdt = TRho::Instance()-&gt;GetPDG();
    static TMaterial air("air","air",14.61,7.3,0.1205000E-02);
    static TSPHE sphere("Particle","Sphere","air",10.0);

<b>// Create a TNode's descendents from the STDHEP structure   </b>
    <a href="../ListOfTypes.html#Int_t">Int_t</a> _nStdHepTracks = <a href="#PAFReader:GetNumberOfMcTruthTracks">GetNumberOfMcTruthTracks</a>();
    <a href=".././PAFMcBase.html">PAFMcBase</a> *stdTrack = &amp;<a href="#PAFReader:GetMcBase">GetMcBase</a>(i);
    
<b>    // this track should not be treated</b>
    if( <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[i]==kFALSE ) {
	return kFALSE;
    }
        
<b>    // get parameters</b>
    <a href="../ListOfTypes.html#double">double</a> vx = stdTrack-&gt;GetStartVx();
    <a href="../ListOfTypes.html#double">double</a> vy = stdTrack-&gt;GetStartVy();
    <a href="../ListOfTypes.html#double">double</a> vz = stdTrack-&gt;GetStartVz();
    
<b>    // make a node</b>
    TParticlePDG *p = pdt-&gt;GetParticle(stdTrack-&gt;GetPdtID());
    const <a href="../ListOfTypes.html#char">char</a> *name = p-&gt;GetName();
    TNode* cand = new TNode(name,"StdHepTree",&amp;sphere,vx,vy,vz);
    cand-&gt;SetUniqueID(i); // Note the MCTruth index
    if (mother==0) {
	mother = cand; // Set the first mother
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:MakeNodeFromStdTrack">PAFReader::MakeNodeFromStdTrack</a>: Setting first mother " &lt;&lt; cand-&gt;GetName() &lt;&lt; endl;
    }
    else if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:MakeNodeFromStdTrack">PAFReader::MakeNodeFromStdTrack</a>: Add node " &lt;&lt; cand-&gt;GetName() &lt;&lt; " with index=";
	cout &lt;&lt; cand-&gt;GetUniqueID();
	cout &lt;&lt; " to " &lt;&lt; mother-&gt;GetName() &lt;&lt; endl;
    }
    
<b>    // don't use this std track anymore</b>
    <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[i]=kFALSE;
    
<b>    // now Std daughters</b>
    <a href="../ListOfTypes.html#int">int</a> firstDaughter = stdTrack-&gt;GetFirstDaughter();
    <a href="../ListOfTypes.html#int">int</a> lastDaughter  = stdTrack-&gt;GetLastDaughter();
    if( firstDaughter&gt;=0 &amp;&amp; lastDaughter&gt;=firstDaughter )
    {
	for( <a href="../ListOfTypes.html#int">int</a> j=firstDaughter; j&lt;=lastDaughter; j++ )
	{
	    if( <a href=".././PAFReader.html#PAFReader:fUseStdHepTrack">fUseStdHepTrack</a>[j]==kFALSE ) continue;
	    if( !<a href="#PAFReader:MakeNodeFromStdTrack">MakeNodeFromStdTrack</a>( j, cand ) )	    
	    {
		cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:MakeNodeFromStdTrack">PAFReader::MakeNodeFromStdTrack</a>: No TNode was built from Std Track" &lt;&lt; endl;
		break;
	    }
	}
    }

    mother-&gt;cd();
    
<b>    // ok</b>
    return kTRUE;
    
}

<a name="PAFReader:SetStreamStatus"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././PAFReader.html#PAFReader:SetStreamStatus">PAFReader::SetStreamStatus</a>(const <a href="../ListOfTypes.html#char">char</a> *stream,<a href="../ListOfTypes.html#Bool_t">Bool_t</a> status)
{
    TString s(stream);
    if (s=="tag")
	<a href=".././PAFReader.html#PAFReader:fTag">fTag</a> = status;
    else if (s=="aod"||s=="micro")
	<a href=".././PAFReader.html#PAFReader:fAod">fAod</a> = status;
    else if (s=="mct")
	<a href=".././PAFReader.html#PAFReader:fMct">fMct</a> = status;
    else if (s=="map"||s=="readMaps")
	<a href=".././PAFReader.html#PAFReader:fMap">fMap</a> = status;
    else if (s=="cmp"||s=="readCmpList")
	<a href=".././PAFReader.html#PAFReader:fCmp">fCmp</a> = status;
    else {
	cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:SetStreamStatus">PAFReader::SetStreamStatus</a>: Stream not defined " &lt;&lt; stream &lt;&lt; endl;
	return kFALSE;
    }

    return kTRUE;
}

<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//                                                                      //</b>
<b>// <a href=".././PAFReader.html">PAFReader</a>								//</b>
<b>//                                                                      //</b>
<b>// Implementation of the PAF event reader classes			//</b>
<b>// This class reads the PAF schema					//</b>
<b>//                                                                      //</b>
<b>// Author: Marcel Kunze, RUB, May 2000					//</b>
<b>// Copyright (C) 1999-2001, Ruhr-University Bochum.			//</b>
<b>//									//</b>
<b>//////////////////////////////////////////////////////////////////////////</b>

#define KTAG      "TagTree"
#define SUFFTAG	  "Tag"
#define KAOD      "AodTree"
#define SUFFAOD	  "Aod"
#define KMAP      "CompTree"
#define SUFFMAP	  "Aod"
#define KMCT      "MctTree"
#define SUFFMCT	  "Mct"

#define TAGBRANCH  "TagList"
#define AODCBRANCH "AodListC"
#define AODNBRANCH "AodListN"
#define MCTBRANCH  "MctList"
#define ASSBRANCH  "AssList"
#define MAPBRANCH  "BtaCandMaps"

<b>// Root includes</b>

#include "TTreeFormula.h"
#include "TClonesArray.h"

<b>// PAF includes</b>

#include "PAFSchema/PAFEventBase.h"
#include "PAFSchema/PAFChargedAodBase.h"
#include "PAFSchema/PAFNeutralAodBase.h"
#include "PAFSchema/PAFCompAodBase.h"
#include "PAFSchema/PAFBitBase.h"
#include "PAFSchema/PAFListBase.h"
#include "PAFSchema/PAFStream.h"
#include "PAFSchema/PAFMicroCandidate.h"
#include "RhoBase/TRho.h"
#include "RhoBase/TCandList.h"
#include "RhoBase/TCandidate.h"
#include "RhoBase/VAbsMicroCandidate.h"

#include "KangaSchema/BtaCandAssocMapR.h"


<a name="PAFReader:InitializeStreams"> </a>void PAFReader::InitializeStreams(Bool_t multi)
{
<b>    // Initialize the "common blocks" (sorry for using fortran slang)</b>
    
    <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>  = new <a href=".././PAFListBase.html">PAFListBase</a>();
    <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:SetTree">SetTree</a>(0);
    <a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a> = new TClonesArray("<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>");
    <a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>-&gt;Clear();
    <a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a> = new TClonesArray("<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>");
    <a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>-&gt;Clear();
    <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a> = new TClonesArray("<a href=".././PAFMcBase.html">PAFMcBase</a>");
    <a href=".././PAFReader.html#PAFReader:fNumMctTracks">fNumMctTracks</a> = 0;
    <a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a> = new TClonesArray("<a href=".././PAFMcAssocBase.html">PAFMcAssocBase</a>");
    <a href=".././PAFReader.html#PAFReader:fNumMcAssoc">fNumMcAssoc</a> = 0;
<b>    //<a href=".././PAFReader.html#PAFReader:fBtaList">fBtaList</a> = new TClonesArray("<a href=".././BtaCandAssocMapR.html">BtaCandAssocMapR</a>");</b>
    
<b>    // Allocate PAF streams</b>
    cout &lt;&lt; "<a href=".././PAFReader.html">PAFReader</a>: Allocate PAF streams" &lt;&lt; endl;
    
<b>    // Set up the default streams:</b>
    
    if (<a href=".././PAFReader.html#PAFReader:fTag">fTag</a>) {
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a> = <a href="#PAFReader:NewStream">NewStream</a>(SUFFTAG,KTAG); 
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddObject">AddObject</a>("",TAGBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fContent">fContent</a>,"<a href=".././PAFEventBase.html">PAFEventBase</a>");
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMajor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMajor">fTimeStampMajor</a>,"i");
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMinor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMinor">fTimeStampMinor</a>,"i");
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>();
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	    cout &lt;&lt; "Add Tag-Stream" &lt;&lt; endl; 
	    <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:PrintOn">PrintOn</a>(cout);
	}
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fAod">fAod</a>) {
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a> = <a href="#PAFReader:NewStream">NewStream</a>(SUFFAOD,KAOD); 
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddClonesArray">AddClonesArray</a>("",AODCBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>,"<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>");
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddClonesArray">AddClonesArray</a>("",AODNBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>,"<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>");
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMajor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMajor">fTimeStampMajor</a>,"i");
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMinor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMinor">fTimeStampMinor</a>,"i");
        <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>();
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	    cout &lt;&lt; "Add Aod-Stream" &lt;&lt; endl; 
	    <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:PrintOn">PrintOn</a>(cout);
	}
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fMct">fMct</a>) {
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a> = <a href="#PAFReader:NewStream">NewStream</a>(SUFFMCT,KMCT); 
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddClonesArray">AddClonesArray</a>("",MCTBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a>,"<a href=".././PAFMcBase.html">PAFMcBase</a>");
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddClonesArray">AddClonesArray</a>("",ASSBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a>,"<a href=".././PAFMcAssocBase.html">PAFMcAssocBase</a>");
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddClonesArray">AddClonesArray</a>("",MAPBRANCH,&amp;<a href=".././PAFReader.html#PAFReader:fBtaList">fBtaList</a>,"<a href=".././BtaCandAssocMapR.html">BtaCandAssocMapR</a>");
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","NumberOfTracks",&amp;<a href=".././PAFReader.html#PAFReader:fNumMctTracks">fNumMctTracks</a>,"I");
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMajor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMajor">fTimeStampMajor</a>,"i");
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddLeaflist">AddLeaflist</a>("","TStampMinor",&amp;<a href=".././PAFReader.html#PAFReader:fTimeStampMinor">fTimeStampMinor</a>,"i");
        <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>();  
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	    cout &lt;&lt; "Add Mct-Stream" &lt;&lt; endl;
	    <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:PrintOn">PrintOn</a>(cout);
	}
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fMap">fMap</a>) {
	<a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a> = <a href="#PAFReader:NewStream">NewStream</a>(SUFFMAP,KMAP); 
	<a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:AddObject">AddObject</a>("","",&amp;<a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>,"<a href=".././PAFListBase.html">PAFListBase</a>");
        <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>();
	if (<a href=".././PAFReader.html#PAFReader:fVerbose">fVerbose</a>) {
	    cout &lt;&lt; "Add Map-Stream" &lt;&lt; endl; 
	    <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:PrintOn">PrintOn</a>(cout);
	}
    }
    
<b>    // Try Opening the files</b>

    const <a href="../ListOfTypes.html#char">char</a> *file = GetName();

    if (<a href=".././PAFReader.html#PAFReader:fTag">fTag</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:OpenFile">OpenFile</a>(file)==0) { 
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
	<a href=".././PAFReader.html#PAFReader:fTag">fTag</a> = kFALSE;
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fAod">fAod</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:OpenFile">OpenFile</a>(file)==0) {
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
	<a href=".././PAFReader.html#PAFReader:fAod">fAod</a> = kFALSE;
    }
    
    
    if (<a href=".././PAFReader.html#PAFReader:fMct">fMct</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:OpenFile">OpenFile</a>(file)==0) {
	<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
	<a href=".././PAFReader.html#PAFReader:fMct">fMct</a> = kFALSE;
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fMap">fMap</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:OpenFile">OpenFile</a>(file)==0) {
	<a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
	<a href=".././PAFReader.html#PAFReader:fMap">fMap</a> = kFALSE;
    }
    
<b>    // Initialize the branches</b>
    
    if (<a href=".././PAFReader.html#PAFReader:fTag">fTag</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>) {
	<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>();
	if (<a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:IsActive">IsActive</a>()) { 
<b>	    // Access Tag branch</b>
	    TTree *tagTree = <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>();
	    if (tagTree!=0) 
		<a href="#PAFReader:InitTagBranches">InitTagBranches</a>(tagTree);
	    else
		cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:InitializeStreams">PAFReader::InitializeStreams</a>: Could not locate TAG tree" &lt;&lt; endl;
	    
<b>	    // Access Kanga compatible Bit branch</b>
<b>	    // Try separate tree first...</b>
	    TTree *bitTree = (TTree*) <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetFile">GetFile</a>()-&gt;Get(SUFFTAG);
	    if (bitTree==0) bitTree = (TTree*) <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>(); // Try new location
	    if (bitTree!=0) 
		<a href="#PAFReader:InitBitBranches">InitBitBranches</a>(bitTree);
	    else
		cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:InitializeStreams">PAFReader::InitializeStreams</a>: Could not locate BIT tree" &lt;&lt; endl;
	    
	    <a href=".././PAFReader.html#PAFReader:fTagStream">fTagStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetEvent">GetEvent</a>(1); // This is to force the TAG-stream to read the tree into memory
	}
    }
    
    if (<a href=".././PAFReader.html#PAFReader:fAod">fAod</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>) <a href="#PAFReader:InitAodBranches">InitAodBranches</a>(<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
    if (<a href=".././PAFReader.html#PAFReader:fMap">fMap</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>) <a href="#PAFReader:InitMapBranches">InitMapBranches</a>(<a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
    if (<a href=".././PAFReader.html#PAFReader:fMct">fMct</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>) <a href="#PAFReader:InitMctBranches">InitMctBranches</a>(<a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
    
    if (!<a href=".././PAFReader.html#PAFReader:fAod">fAod</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>) <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
    if (!<a href=".././PAFReader.html#PAFReader:fMap">fMap</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>) <a href=".././PAFReader.html#PAFReader:fMapStream">fMapStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
    if (!<a href=".././PAFReader.html#PAFReader:fMct">fMct</a> &amp;&amp; <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>) <a href=".././PAFReader.html#PAFReader:fMctStream">fMctStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Disable">Disable</a>();
}

<a name="PAFReader:GetNumberOfLists"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfLists">PAFReader::GetNumberOfLists</a>() const
{
    return <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:GetNumberOfLists">GetNumberOfLists</a>();
}

<a name="PAFReader:GetListName"> </a>const <a href="../ListOfTypes.html#char">char</a>* <a href=".././PAFReader.html#PAFReader:GetListName">PAFReader::GetListName</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const
{
    return <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:GetListName">GetListName</a>(i);
}

<b>// _______________________________________________________________</b>
<b>// Methods to enable branches dynamically </b>
<b>// MUST be called each time the TAG- or AOD- trees are changed </b>
<b>// _______________________________________________________________</b>

<a name="PAFReader:InitTagBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitTagBranches">PAFReader::InitTagBranches</a>(TTree *theTree)
{
    if (theTree==0) return;
<b>    // Switch off all Branches</b>
    TBranch *mainBranch = (TBranch*) ((*theTree-&gt;GetListOfBranches())[0]);
    TObjArray *allBranches = mainBranch-&gt;GetListOfBranches();
    theTree-&gt;SetBranchStatus("*",1);
    
<b>    // Notify PAFKangaReaderBase </b>
    <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:SetTree">SetTree</a>(theTree);
    
<b>    // Set up formula</b>
    if (<a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a>!="") { 
	cout &lt;&lt; "<a href=".././PAFReader.html#PAFReader:TagSelection">PAFReader::TagSelection</a> " &lt;&lt; <a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a> &lt;&lt; endl;
	if (<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>!=0) { delete <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>; <a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a>=0; }
	<a href=".././PAFReader.html#PAFReader:fTagFormula">fTagFormula</a> = new TTreeFormula("theTagFormula",<a href=".././PAFReader.html#PAFReader:fPAFTagExpr">fPAFTagExpr</a>.Data(),theTree);
    }
} 

<a name="PAFReader:InitBitBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitBitBranches">PAFReader::InitBitBranches</a>(TTree *theTree)
{
    if (theTree==0) return;
<b>    // Switch off all Branches</b>
    TBranch *mainBranch = (TBranch*) ((*theTree-&gt;GetListOfBranches())[0]);
    TObjArray *allBranches = mainBranch-&gt;GetListOfBranches();
    theTree-&gt;SetBranchStatus("*",1);
    
<b>    // Notify bit stream</b>
    <a href=".././PAFReader.html#PAFReader:fBits">fBits</a>-&gt;SetTree(theTree);
    
<b>    // Set up formula</b>
    if (<a href=".././PAFReader.html#PAFReader:fBitExpr">fBitExpr</a>!="") { 
        if (<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>!=0) { delete <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>; <a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a>=0; }
	<a href=".././PAFReader.html#PAFReader:fBitFormula">fBitFormula</a> = new TTreeFormula("theBitFormula",<a href=".././PAFReader.html#PAFReader:fBitExpr">fBitExpr</a>.Data(),theTree);
    }
} 

<a name="PAFReader:InitAodBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitAodBranches">PAFReader::InitAodBranches</a>(TTree *theTree)
{
    if (theTree==0) return;
<b>    // Disable all Aod - Branches</b>
    theTree-&gt;SetBranchStatus("*",0); // Switch off all branches (read smart members)
    <a href="../ListOfTypes.html#Int_t">Int_t</a> version = theTree-&gt;GetCurrentFile()-&gt;GetVersion();
    TString aodcbranch = TString(AODCBRANCH);
    if (version&lt;30000) aodcbranch += "_"; // ROOT2 requires an underscore here...
    theTree-&gt;SetBranchStatus(aodcbranch,1);
    TString aodnbranch = TString(AODNBRANCH);
    if (version&lt;30000) aodnbranch += "_"; // ROOT2 requires an underscore here...
    theTree-&gt;SetBranchStatus(aodnbranch,1);
}

<a name="PAFReader:InitMapBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitMapBranches">PAFReader::InitMapBranches</a>(TTree *theTree)
{
    if (theTree==0) return;
<b>    //theTree-&gt;SetBranchStatus("*",1);</b>
    <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:SetTree">SetTree</a>(theTree);
}

<a name="PAFReader:InitMctBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitMctBranches">PAFReader::InitMctBranches</a>(TTree *theTree)
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> version = theTree-&gt;GetCurrentFile()-&gt;GetVersion();
    theTree-&gt;SetBranchStatus("*",1); // ROOT 2.25/03 requires branches to be switched on
    TString mctbranch = TString(MCTBRANCH);
    if (version&lt;30000) mctbranch += "_"; // ROOT2 requires an underscore here...
    theTree-&gt;SetBranchStatus(mctbranch,1);
}

<a name="PAFReader:InitTruBranches"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:InitTruBranches">PAFReader::InitTruBranches</a>(TTree *theTree)
{}

<a name="PAFReader:GetNumberOfTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfTracks">PAFReader::GetNumberOfTracks</a>() const 
{
<b>    // Return the total number of tracks in the event    </b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetNumberOfTracks">GetNumberOfTracks</a>();
}

<a name="PAFReader:GetNumberOfChargedTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfChargedTracks">PAFReader::GetNumberOfChargedTracks</a>() const 
{
<b>    // Return the number of charged tracks in the event</b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetNumberOfChargedTracks">GetNumberOfChargedTracks</a>();
}

<a name="PAFReader:GetNumberOfNeutralTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfNeutralTracks">PAFReader::GetNumberOfNeutralTracks</a>() const 
{
<b>    // Return the number of neutral tracks in the event</b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetNumberOfNeutralTracks">GetNumberOfNeutralTracks</a>();
}

<a name="PAFReader:GetRunNumber"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetRunNumber">PAFReader::GetRunNumber</a>() const 
{
<b>    // Return the actual run number</b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetRunNumber">GetRunNumber</a>();
}

<a name="PAFReader:GetEventNumber"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetEventNumber">PAFReader::GetEventNumber</a>() const 
{
<b>    // Return the actual event number</b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetEventNumber">GetEventNumber</a>();
}

<a name="PAFReader:GetMajorID"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetMajorID">PAFReader::GetMajorID</a>() const 
{
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetMajorID">GetMajorID</a>();
}

<a name="PAFReader:GetMinorID"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetMinorID">PAFReader::GetMinorID</a>() const 
{
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetMinorID">GetMinorID</a>();
}


<b>// Access to object handles</b>

<a name="PAFReader:GetHeader"> </a><a href=".././PAFEventBase.html">PAFEventBase</a>&amp; <a href=".././PAFReader.html#PAFReader:GetHeader">PAFReader::GetHeader</a>() const 
{
<b>    // Return a handle to the event header</b>
    return *<a href=".././PAFReader.html#PAFReader:fContent">fContent</a>;
}    

<a name="PAFReader:GetTag"> </a>VAbsTag&amp; <a href=".././PAFReader.html#PAFReader:GetTag">PAFReader::GetTag</a>() const 
{
<b>    // Return a handle to the TAG</b>
    return <a href=".././PAFReader.html#PAFReader:fContent">fContent</a>-&gt;<a href=".././PAFEventBase.html#PAFEventBase:GetTag">GetTag</a>();
}

<a name="PAFReader:GetBit"> </a>VAbsBit&amp; <a href=".././PAFReader.html#PAFReader:GetBit">PAFReader::GetBit</a>() const 
{
<b>    // Return a handle to the BIT</b>
    return *<a href=".././PAFReader.html#PAFReader:fBits">fBits</a>;
}    

<a name="PAFReader:GetEidInfo"> </a><a href=".././EidInfoR.html">EidInfoR</a>&amp; <a href=".././PAFReader.html#PAFReader:GetEidInfo">PAFReader::GetEidInfo</a>() const 
{
<b>    // Return a handle to the EidInfo</b>
    return *<a href=".././PAFReader.html#PAFReader:fEidInfo">fEidInfo</a>;
}

<a name="PAFReader:GetListBase"> </a><a href=".././PAFListBase.html">PAFListBase</a>&amp; <a href=".././PAFReader.html#PAFReader:GetListBase">PAFReader::GetListBase</a>() const 
{
/*    if (<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>) { 
	<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:Enable">Enable</a>(); // Make sure stream is enabled (File is open)
	if (<a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:GetTree">GetTree</a>()==0) {
	    TTree *theTree = (TTree*) <a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetFile">GetFile</a>()-&gt;Get(KMAP);
	    <a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>-&gt;<a href=".././PAFListBase.html#PAFListBase:SetTree">SetTree</a>(theTree);
	}
    }
*/    return *<a href=".././PAFReader.html#PAFReader:fAodListsComp">fAodListsComp</a>;
}


<a name="PAFReader:GetMcBase"> </a><a href=".././PAFMcBase.html">PAFMcBase</a>&amp; <a href=".././PAFReader.html#PAFReader:GetMcBase">PAFReader::GetMcBase</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const 
{
<b>    // Return a handle to the McB of the i-th Truth Object</b>
    return *((<a href=".././PAFMcBase.html">PAFMcBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a>)[i]);   // replace by dynamic_cast&lt;<a href=".././PAFMcBase.html">PAFMcBase</a>*&gt; as soon as allowed
}

<a name="PAFReader:GetMcAssocBase"> </a><a href=".././PAFMcAssocBase.html">PAFMcAssocBase</a>&amp; <a href=".././PAFReader.html#PAFReader:GetMcAssocBase">PAFReader::GetMcAssocBase</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) 
{
<b>    // Return a handle to the McB of the i-th Truth Object</b>
    return *((<a href=".././PAFMcAssocBase.html">PAFMcAssocBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a>)[i]);   // replace by dynamic_cast&lt;<a href=".././PAFMcBase.html">PAFMcBase</a>*&gt; as soon as allowed
}

<a name="PAFReader:GetStdHepTrk"> </a><a href=".././StdHepTrkR.html">StdHepTrkR</a>&amp; <a href=".././PAFReader.html#PAFReader:GetStdHepTrk">PAFReader::GetStdHepTrk</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const 
{
<b>    // Return a handle to the MCT of the i-th Truth Object</b>
    static <a href=".././StdHepTrkR.html">StdHepTrkR</a> *trk=0;
    return *trk;   // This is not implemented
}

<a name="PAFReader:GetCandAssocMap"> </a><a href=".././BtaCandAssocMapR.html">BtaCandAssocMapR</a>&amp; <a href=".././PAFReader.html#PAFReader:GetCandAssocMap">PAFReader::GetCandAssocMap</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const 
{
<b>    // Return a handle to the MC association of i-th track</b>
    return *((<a href=".././BtaCandAssocMapR.html">BtaCandAssocMapR</a>*)(*<a href=".././PAFReader.html#PAFReader:fBtaList">fBtaList</a>)[i]);   // replace by dynamic_cast&lt;<a href=".././PAFMcBase.html">PAFMcBase</a>*&gt; as soon as allowed
}

<a name="PAFReader:GetCandList"> </a><a href=".././BtaCandListR.html">BtaCandListR</a>&amp; <a href=".././PAFReader.html#PAFReader:GetCandList">PAFReader::GetCandList</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const 
{
<b>    // Return a handle to the MC association of i-th track</b>
    static <a href=".././BtaCandListR.html">BtaCandListR</a> *trk=0;
    return *trk;   // This is not implemented
}

<a name="PAFReader:GetNumberOfCandAssocs"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfCandAssocs">PAFReader::GetNumberOfCandAssocs</a>() const 
{
    if (<a href=".././PAFReader.html#PAFReader:fNumMcAssoc">fNumMcAssoc</a>&gt;0) 
	return <a href=".././PAFReader.html#PAFReader:fNumMcAssoc">fNumMcAssoc</a>;
    else 
	return ( <a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a> ? <a href=".././PAFReader.html#PAFReader:fAssList">fAssList</a>-&gt;GetEntriesFast() : 0 ); 
}

<a name="PAFReader:GetNumberOfMcTruthTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././PAFReader.html#PAFReader:GetNumberOfMcTruthTracks">PAFReader::GetNumberOfMcTruthTracks</a>() const 
{
    if (<a href=".././PAFReader.html#PAFReader:fNumMctTracks">fNumMctTracks</a>&gt;0) 
	return <a href=".././PAFReader.html#PAFReader:fNumMctTracks">fNumMctTracks</a>;
    else 
	return ( <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a> ? <a href=".././PAFReader.html#PAFReader:fMctList">fMctList</a>-&gt;GetEntriesFast() : 0 ); 
}

<a name="PAFReader:SetChargedTree"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:SetChargedTree">PAFReader::SetChargedTree</a>()
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nc = <a href="#PAFReader:GetNumberOfChargedTracks">GetNumberOfChargedTracks</a>();
    
    while (<a href=".././PAFReader.html#PAFReader:fMaxC">fMaxC</a>&lt;nc) {
	<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a> *b = (<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>*) ( (*<a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>)[<a href=".././PAFReader.html#PAFReader:fMaxC">fMaxC</a>] );
	if (<a href=".././PAFReader.html#PAFReader:fMaxC">fMaxC</a>&gt;0) {
	    b-&gt;SetTree(  (<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>*) ((*<a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>)[0]) );
	} else {
	    b-&gt;SetTree(<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
	}
	<a href=".././PAFReader.html#PAFReader:fMaxC">fMaxC</a>++;
    }
}

<a name="PAFReader:SetNeutralTree"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././PAFReader.html#PAFReader:SetNeutralTree">PAFReader::SetNeutralTree</a>()
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nn = <a href="#PAFReader:GetNumberOfNeutralTracks">GetNumberOfNeutralTracks</a>();
    
    while (<a href=".././PAFReader.html#PAFReader:fMaxN">fMaxN</a>&lt;nn) {
	<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a> *b = (<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>*) ( (*<a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>)[<a href=".././PAFReader.html#PAFReader:fMaxN">fMaxN</a>] );
	if (<a href=".././PAFReader.html#PAFReader:fMaxN">fMaxN</a>&gt;0) {
	    b-&gt;SetTree(  (<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>*) ((*<a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>)[0]) );
	} else {
	    b-&gt;SetTree(<a href=".././PAFReader.html#PAFReader:fAodStream">fAodStream</a>-&gt;<a href=".././PAFStream.html#PAFStream:GetTree">GetTree</a>());
	}
	<a href=".././PAFReader.html#PAFReader:fMaxN">fMaxN</a>++;
    }
}

<a name="PAFReader:GetMicroCandidate"> </a>VAbsMicroCandidate&amp; <a href=".././PAFReader.html#PAFReader:GetMicroCandidate">PAFReader::GetMicroCandidate</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const
{
<b>    // Return a handle to the Micro of the i-th track</b>
    
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nc = <a href="#PAFReader:GetNumberOfChargedTracks">GetNumberOfChargedTracks</a>();
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nn = <a href="#PAFReader:GetNumberOfNeutralTracks">GetNumberOfNeutralTracks</a>();
    
    <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a> *aod = 0;
    
    if (i&lt;nc) {
	const_cast&lt;<a href=".././PAFReader.html">PAFReader</a>*&gt;(this)-&gt;<a href="#PAFReader:SetChargedTree">SetChargedTree</a>();
	<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a> &amp;caod = *((<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>)[i]);
	new ((*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[i]) <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>(caod.GetBase(),caod.GetCluster(),caod.GetTrack());
	aod = (<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>*)(*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[i];
    }
    else if (i&gt;=nc &amp;&amp; i&lt;nc+nn) {
	const_cast&lt;<a href=".././PAFReader.html">PAFReader</a>*&gt;(this)-&gt;<a href="#PAFReader:SetNeutralTree">SetNeutralTree</a>();
	<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a> &amp;naod = *((<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>)[i-nc]);
	new ((*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[i]) <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>(naod.GetBase(),naod.GetCluster(),0);
	aod = (<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>*)(*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[i];
    } else {
	cout &lt;&lt; " *** WARNING in <a href=".././PAFReader.html#PAFReader:GetMicroCandidate">PAFReader::GetMicroCandidate</a> : " &lt;&lt; endl;
	cout &lt;&lt; "     Requested MicroCandidate #" &lt;&lt; i &lt;&lt; " not available " &lt;&lt; endl;
    }
    return *aod;
}

<a name="PAFReader:Fill"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:Fill">PAFReader::Fill</a>(TCandList *l) 
{
<b>    // Generate candidates and fill them into a list</b>
    
    <a href="../ListOfTypes.html#UInt_t">UInt_t</a> nEntries = <a href="#PAFReader:GetNumberOfTracks">GetNumberOfTracks</a>();
    l-&gt;Cleanup();
    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a> = 0;
    for (<a href="../ListOfTypes.html#UInt_t">UInt_t</a> i=0;i&lt;nEntries;++i) {
	l-&gt;Put(TCandidate(<a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(i),i));
    }
    return nEntries;
}

<a name="PAFReader:FillCharged"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:FillCharged">PAFReader::FillCharged</a>(TCandList *l) 
{
<b>    // Generate charged candidates and fill them into a list</b>
    
    <a href="../ListOfTypes.html#UInt_t">UInt_t</a> nEntries = <a href="#PAFReader:GetNumberOfChargedTracks">GetNumberOfChargedTracks</a>();
    l-&gt;Cleanup();
    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a> = 0;
    for (<a href="../ListOfTypes.html#UInt_t">UInt_t</a> i=0;i&lt;nEntries;++i) {
	<a href="#PAFReader:SetChargedTree">SetChargedTree</a>();
	<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a> &amp;aod = *((<a href=".././PAFChargedAodBase.html">PAFChargedAodBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fAodListCharged">fAodListCharged</a>)[i]);
	new ((*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>]) <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>(aod.GetBase(),aod.GetCluster(),aod.GetTrack());
	<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a> *c = (<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>*)(*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>];
	l-&gt;Put(TCandidate(*c,<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>));
	<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>++;
    }
    return <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>;
}

<a name="PAFReader:FillNeutral"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:FillNeutral">PAFReader::FillNeutral</a>(TCandList *l) 
{
<b>    // Generate neutral candidates and fill them into a list</b>
    
    <a href="../ListOfTypes.html#UInt_t">UInt_t</a> nEntries = <a href="#PAFReader:GetNumberOfNeutralTracks">GetNumberOfNeutralTracks</a>();
    l-&gt;Cleanup();
    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a> = <a href="#PAFReader:GetNumberOfChargedTracks">GetNumberOfChargedTracks</a>();
    for (<a href="../ListOfTypes.html#UInt_t">UInt_t</a> i=0;i&lt;nEntries;++i) {
	<a href="#PAFReader:SetNeutralTree">SetNeutralTree</a>();
	<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a> &amp;aod = *((<a href=".././PAFNeutralAodBase.html">PAFNeutralAodBase</a>*)(*<a href=".././PAFReader.html#PAFReader:fAodListNeutral">fAodListNeutral</a>)[i]);
	if (aod.GetEmcNumberOfBumps()&lt;=1) {
	    new ((*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>]) <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>(aod.GetBase(),aod.GetCluster(),0);
	    <a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a> *c = (<a href=".././PAFMicroCandidate.html">PAFMicroCandidate</a>*)(*<a href=".././PAFReader.html#PAFReader:fOwnList">fOwnList</a>)[<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>];
	    l-&gt;Put(TCandidate(*c,<a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>));
	    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>++;
	}
    }
    return <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>;
}

<a name="PAFReader:FillFromList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././PAFReader.html#PAFReader:FillFromList">PAFReader::FillFromList</a>(TCandList *l,const <a href="../ListOfTypes.html#char">char</a>* listname)
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> currentIndex = <a href="#PAFReader:GetCurrentIndex">GetCurrentIndex</a>(); // The current entry
    
<b>    // Clean the list</b>
    l-&gt;Cleanup();
    
<b>    // Get handle to the list array</b>
    <a href=".././PAFListBase.html">PAFListBase</a>&amp; theListBase = <a href="#PAFReader:GetListBase">GetListBase</a>();
    
<b>    // PAF specific lists</b>
    TClonesArray *theList = theListBase.GetList(listname,currentIndex);
    if (theList==0) { return 0; }
    <a href="../ListOfTypes.html#Int_t">Int_t</a> len = theListBase.GetListLength(listname,currentIndex);
    if (len&lt;0 || len &gt;100) {
	cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:FillFromList">PAFReader::FillFromList</a>: Skip irrational list length: " &lt;&lt; len &lt;&lt; endl;
	return 0;
    }
    
    l-&gt;Cleanup();
    
    for (<a href="../ListOfTypes.html#Int_t">Int_t</a> i=0; i&lt;len; i++) {
	<a href=".././PAFCompAodBase.html">PAFCompAodBase</a> *b = (<a href=".././PAFCompAodBase.html">PAFCompAodBase</a>*) ((*theList)[i]);
	<a href="../ListOfTypes.html#Int_t">Int_t</a> index = b-&gt;GetAodRef();
	if (index&lt;-1 || index&gt;128) {
	    cerr &lt;&lt; "<a href=".././PAFReader.html#PAFReader:FillFromList">PAFReader::FillFromList</a>: Skip irrational index: " &lt;&lt; index &lt;&lt; endl;
	    continue;
	}
	
	if (index==-1) {    
<b>	    // Produce a V0</b>
	    if ((b-&gt;GetDaughter(0)!=-1) &amp;&amp; (b-&gt;GetDaughter(1)!=-1)) {
		TCandidate *c0 = new TCandidate(<a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(b-&gt;GetDaughter(0)),b-&gt;GetDaughter(0));
		TCandidate *c1 = new TCandidate(<a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(b-&gt;GetDaughter(1)),b-&gt;GetDaughter(1));
		TCandidate *c2 = c0-&gt;Combine(*c1);
		l-&gt;Put(TCandidate(*c2));
		TCandidate&amp; theCand = (*l)[i];
		theCand.AddDaughterLink(c0);  theCand.AddDaughterLink(c1); 
		delete c0; delete c1; delete c2;
		<a href="../ListOfTypes.html#Int_t">Int_t</a> type = b-&gt;GetPdtRef();
		if (type == 0) type = 100; // Geantino
		theCand.SetType(TRho::Instance()-&gt;GetPDG()-&gt;GetParticle(type));
	    } else {
		cout &lt;&lt; " *** WARNING in <a href=".././PAFReader.html#PAFReader:FillFromList">PAFReader::FillFromList</a> : " &lt;&lt; endl;
		cout &lt;&lt; "     this V0 has less than 2 Daughters ! " &lt;&lt; endl;
	    }
	} else if (b-&gt;GetDaughter(0)==-1) {
<b>	    // Make 'simple' PAFCand from specific element in Aod-List</b>
	    VAbsMicroCandidate &amp;c = <a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(index);
	    l-&gt;Put(TCandidate(c,index));
	    TCandidate &amp;theCand = (*l)[i];
	    <a href="../ListOfTypes.html#Int_t">Int_t</a> type = b-&gt;GetPdtRef();
	    if (type == 0) type = 100; // Geantino
	    theCand.SetType(TRho::Instance()-&gt;GetPDG()-&gt;GetParticle(type));
	    <a href=".././PAFReader.html#PAFReader:fEntries">fEntries</a>++;
	} else {
<b>	    // Produce a cluster</b>
	    VAbsMicroCandidate &amp;micro = <a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(index);
	    l-&gt;Put(TCandidate(micro,index));
	    TCandidate&amp; theCand = (*l)[i];
	    <a href="../ListOfTypes.html#Int_t">Int_t</a> type = b-&gt;GetPdtRef();
	    if (type == 0) type = 100; // Geantino
	    theCand.SetType(TRho::Instance()-&gt;GetPDG()-&gt;GetParticle(type));
	    <a href="../ListOfTypes.html#Int_t">Int_t</a> k=0;
	    while (b-&gt;GetDaughter(k)&gt;0) {
		VAbsMicroCandidate &amp;micro = <a href="#PAFReader:GetMicroCandidate">GetMicroCandidate</a>(b-&gt;GetDaughter(k));
		TCandidate *c = new TCandidate(micro,b-&gt;GetDaughter(k));
		theCand.AddDaughterLink(c);
		delete c;
		k++;
	    }      
	    for (<a href="../ListOfTypes.html#Int_t">Int_t</a> markerindex=0; markerindex&lt;4; markerindex++) {
		<a href="../ListOfTypes.html#Int_t">Int_t</a> currentMarker = theCand.GetMarker(markerindex);
		for (<a href="../ListOfTypes.html#Int_t">Int_t</a> dau=0; dau&lt;theCand.NDaughters(); dau++) {
		    currentMarker |= theCand.Daughter(dau)-&gt;GetMarker(markerindex);
		}
		theCand.SetMarker(currentMarker,markerindex);
	    }
	}
    }
    
    return len;
} 

<a name="PAFReader:GetCompositeCandidate"> </a>TCandidate&amp; <a href=".././PAFReader.html#PAFReader:GetCompositeCandidate">PAFReader::GetCompositeCandidate</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const
{
    static TCandidate c;
    return c;
}

</pre>

<!--SIGNATURE-->
<br>
<hr>
<center>
<address>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</address>
</center>
<hr>
<address>
This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
