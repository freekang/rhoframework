<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Fri Dec 20 16:02:59 2002            -->
<!--                                             -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>TGoodTrackSelector - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, windows, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//                                                                      //</b>
<b>// <a href=".././TGoodTrackSelector.html">TGoodTrackSelector</a>						        //</b>
<b>//                                                                      //</b>
<b>// Selector classes for particle selection                              //</b>
<b>//                                                                      //</b>
<b>// Author List:                                                         //</b>
<b>// Marcel Kunze,  RUB, Feb. 99                                          //</b>
<b>// Copyright (C) 1999-2001, Ruhr-University Bochum.                     //</b>
<b>//                                                                      //</b>
<b>//////////////////////////////////////////////////////////////////////////</b>

#include "RhoSelector/TGoodTrackSelector.h"
#include "RhoSelector/TPidQuality.h"

#include "RhoBase/TRho.h"
#include "RhoBase/TCandidate.h"
#include "RhoBase/VAbsMicroCandidate.h"

#include "RhoConditions/TConditions.h"
#include "RhoConditions/TBeams.h"

ClassImp(TGoodTrackSelector)

TBuffer &amp;operator&gt;&gt;(TBuffer &amp;buf, TGoodTrackSelector *&amp;obj)
{
   obj = (TGoodTrackSelector *) buf.ReadObject(TGoodTrackSelector::Class());
   return buf;
}

#include &lt;iostream&gt;
using namespace std;

<a name="TGoodTrackSelector:TGoodTrackSelector"> </a>TGoodTrackSelector::TGoodTrackSelector(const char *name, Int_t nh, Double_t pt, Double_t chipm, Double_t d,Double_t z, Double_t emc,Bool_t qc) : 
VAbsPidSelector(name,"pi-") 
{
    SetHits(nh);
    SetDchHits(0);
    SetSvtHits(0);
    SetPrimaryVertex(d,-z,z);
    SetMomentum(0);
    SetPt(pt);
    SetFit(chipm);
    SetPhi(0, kTWOPI);
    SetTheta(0, kTWOPI);
    SetLength(0,1.E8);
    SetShowerEnergy(emc);

    if (qc) fQC = new TPidQuality(name);
}

<a name="TGoodTrackSelector:~TGoodTrackSelector"> </a>TGoodTrackSelector::~TGoodTrackSelector() { delete fQC; }    

<a name="TGoodTrackSelector:SetCriterion"> </a>void TGoodTrackSelector::SetCriterion(const char* c)
{
<b>    // Set criteria accroding to </b>
<b>    // http://babar-hn.slac.stanford.edu:5090/HyperNews/get/AnalTools/273.html</b>
    TString crit(c);

    if (crit=="veryLoose") {
	<a href="#TGoodTrackSelector:SetHits">SetHits</a>(4);
	<a href="#TGoodTrackSelector:SetPrimaryVertex">SetPrimaryVertex</a>(1.5,-10.,10.);
	<a href="#TGoodTrackSelector:SetDchHits">SetDchHits</a>(0);
	<a href="#TGoodTrackSelector:SetSvtHits">SetSvtHits</a>(0);
	<a href="#TGoodTrackSelector:SetMomentum">SetMomentum</a>(0,10.);
	<a href="#TGoodTrackSelector:SetPt">SetPt</a>(0.0);
	<a href="#TGoodTrackSelector:SetFit">SetFit</a>(0.0);
	<a href="#TGoodTrackSelector:SetPhi">SetPhi</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetTheta">SetTheta</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetLength">SetLength</a>(0,1.E8);
	<a href="#TGoodTrackSelector:SetShowerEnergy">SetShowerEnergy</a>(0.0);
    }
    else if (crit=="loose") {
	<a href="#TGoodTrackSelector:SetHits">SetHits</a>(11);
	<a href="#TGoodTrackSelector:SetPrimaryVertex">SetPrimaryVertex</a>(1.5,-10.,10.);
	<a href="#TGoodTrackSelector:SetDchHits">SetDchHits</a>(11);
	<a href="#TGoodTrackSelector:SetSvtHits">SetSvtHits</a>(0);
	<a href="#TGoodTrackSelector:SetMomentum">SetMomentum</a>(0,10.);
	<a href="#TGoodTrackSelector:SetPt">SetPt</a>(0.1);
	<a href="#TGoodTrackSelector:SetFit">SetFit</a>(0.0);
	<a href="#TGoodTrackSelector:SetPhi">SetPhi</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetTheta">SetTheta</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetLength">SetLength</a>(0,1.E8);
	<a href="#TGoodTrackSelector:SetShowerEnergy">SetShowerEnergy</a>(0.0);
    }
    else {
	<a href="#TGoodTrackSelector:SetHits">SetHits</a>(19);
	<a href="#TGoodTrackSelector:SetPrimaryVertex">SetPrimaryVertex</a>(1.0,-3.,3.);
	<a href="#TGoodTrackSelector:SetDchHits">SetDchHits</a>(19);
	<a href="#TGoodTrackSelector:SetSvtHits">SetSvtHits</a>(0);
	<a href="#TGoodTrackSelector:SetMomentum">SetMomentum</a>(0,10.);
	<a href="#TGoodTrackSelector:SetPt">SetPt</a>(0.1);
	<a href="#TGoodTrackSelector:SetFit">SetFit</a>(0.0);
	<a href="#TGoodTrackSelector:SetPhi">SetPhi</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetTheta">SetTheta</a>(0, kTWOPI);
	<a href="#TGoodTrackSelector:SetLength">SetLength</a>(0,1.E8);
	<a href="#TGoodTrackSelector:SetShowerEnergy">SetShowerEnergy</a>(0.0);
    }

    VAbsPidSelector::<a href="#TGoodTrackSelector:SetCriterion">SetCriterion</a>(c);
}

<a name="TGoodTrackSelector:Accept"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:Accept">TGoodTrackSelector::Accept</a>(TCandidate&amp; b) 
{
<b>    // The GoodTrackSelector does a selection based on the</b>
<b>    // quality of a reconstructed charged track</b>
    
    if (&amp;b == 0) return kFALSE;
    if (!<a href="#TGoodTrackSelector:Accept">Accept</a>(b.GetMicroCandidate())) return kFALSE;
    SetTypeAndMass(b);
    
    return kTRUE;
}

<a name="TGoodTrackSelector:Accept"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:Accept">TGoodTrackSelector::Accept</a>(VAbsMicroCandidate&amp; cand) 
{
<b>    // The GoodTrackSelector does a selection based on the</b>
<b>    // quality of a reconstructed charged track</b>
    
    if (&amp;cand == 0) return kFALSE;
    
    if (cand.GetCharge() == 0) return kFALSE;
    
<b>    // Cut on number of hits and distance from inner to outer layer</b>

    <a href="../ListOfTypes.html#Int_t">Int_t</a> ndch = cand.GetDchHits();			// Get the number of DCH hits
    <a href="../ListOfTypes.html#Int_t">Int_t</a> nsvt = cand.GetSvtHits();			// Get the number of SVT hits
    if (ndch+nsvt &lt;= <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsMin">nHitsMin</a>) return kFALSE;
    if (ndch+nsvt &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsMax">nHitsMax</a>) return kFALSE;
    if (ndch      &lt;= <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsDchMin">nHitsDchMin</a>) return kFALSE;
    if (ndch      &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsDchMax">nHitsDchMax</a>) return kFALSE;
    if (nsvt      &lt;= <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsSvtMin">nHitsSvtMin</a>) return kFALSE;
    if (nsvt      &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsSvtMax">nHitsSvtMax</a>) return kFALSE;
    if (cand.GetDchOuterLayer() - cand.GetDchInnerLayer() &lt;= <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:spanDch">spanDch</a>) return kFALSE;
    
<b>    // Cut on momenta</b>
    
    TVector3 p = cand.GetMomentum();
    if (p.Mag()  &lt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:pMin">pMin</a>)  return kFALSE;
    if (p.Mag()  &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:pMax">pMax</a>)  return kFALSE;
    if (p.Perp() &lt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:ptMin">ptMin</a>) return kFALSE;
    if (p.Perp() &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:ptMax">ptMax</a>) return kFALSE;
    
<b>    // Check angular acceptance</b>
    
    if (p.Theta() &lt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:thetaMin">thetaMin</a>) return kFALSE;
    if (p.Theta() &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:thetaMax">thetaMax</a>) return kFALSE;
    if (p.Phi()+kPI   &lt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:phiMin">phiMin</a>)   return kFALSE;
    if (p.Phi()+kPI   &gt;  <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:phiMax">phiMax</a>)   return kFALSE;
    
<b>    // Check track length</b>
    
    if (cand.GetTrackLength() &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:lengthMin">lengthMin</a>) return kFALSE;
    if (cand.GetTrackLength() &gt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:lengthMax">lengthMax</a>) return kFALSE;
    
<b>    // Cut on quality of fit</b>
    
    if (cand.GetProbability() &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:chisqProbMin">chisqProbMin</a>) return kFALSE;
    if (cand.GetChiSquared()  &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:chisquare">chisquare</a>)    return kFALSE;
    if (cand.GetDegreesOfFreedom() &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nDof">nDof</a>)    return kFALSE;
    
<b>    // Cut on beam spot position</b>
    
    TVector3 v = cand.GetPosition();	// Get the starting point (spot corrected)

    <a href=".././TConditions.html">TConditions</a> *theConditions = TRho::Instance()-&gt;GetConditions();
    if (theConditions == 0) {
	cerr &lt;&lt; "VAbsPidSelector: No handle to conditions manager." &lt;&lt; endl;
	abort();
    }

    if (theConditions != 0) {
	<a href=".././TRhoTime.html">TRhoTime</a> *theTime = TRho::Instance()-&gt;GetTime();
	if (theTime!=0) 
	    theConditions-&gt;At(*theTime);	// Read the beam conditions DB
	else
	    theConditions-&gt;At(0);
	<a href=".././TBeams.html">TBeams</a> *beams = theConditions-&gt;GetBeams();
	v = v - beams-&gt;Interaction3Point();
    }

    if (v.Z()  &gt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMax">zMax</a>) return kFALSE;
    if (v.Z()  &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMin">zMin</a>) return kFALSE;
    if (v.Perp() &gt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:docaMax">docaMax</a>) return kFALSE;
    
<b>    // Check matched EMC energy deposit</b>
    
    <a href="../ListOfTypes.html#Float_t">Float_t</a> emc  = cand.GetEmcRawEnergy();
    if (emc &lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:emcMin">emcMin</a>) return kFALSE;
    
    return kTRUE;
}

<a name="TGoodTrackSelector:PrintOn"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:PrintOn">TGoodTrackSelector::PrintOn</a>(std::ostream&amp; o) const 
{
    o &lt;&lt; GetName() &lt;&lt; endl;
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsMin">nHitsMin</a> &gt; 0)     o &lt;&lt; "Number of Hits       = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsMin">nHitsMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsMax">nHitsMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsDchMin">nHitsDchMin</a> &gt; 0)  o &lt;&lt; "Number of DCH Hits   = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsDchMin">nHitsDchMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsDchMax">nHitsDchMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsSvtMin">nHitsSvtMin</a> &gt; 0)  o &lt;&lt; "Number of SVT Hits   = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsSvtMin">nHitsSvtMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nHitsSvtMax">nHitsSvtMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:pMin">pMin</a> &gt; 0)         o &lt;&lt; "Momentum range       = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:pMin">pMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:pMax">pMax</a> &lt;&lt; " GeV" &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:ptMin">ptMin</a> &gt; 0)        o &lt;&lt; "Momentum range (Pt)  = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:ptMin">ptMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:ptMax">ptMax</a> &lt;&lt; " GeV" &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:chisqProbMin">chisqProbMin</a> &gt; 0) o &lt;&lt; "Fit probability/chi2 = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:chisqProbMin">chisqProbMin</a> &lt;&lt; '/' &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:chisquare">chisquare</a> &lt;&lt; endl;
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nDof">nDof</a> &gt; 0)         o &lt;&lt; "nDoF                 &gt; " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:nDof">nDof</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:thetaMin">thetaMin</a> &gt; 0)     o &lt;&lt; "Theta [Rad]          = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:thetaMin">thetaMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:thetaMax">thetaMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:phiMin">phiMin</a> &gt; 0)       o &lt;&lt; "Phi   [Rad]          = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:phiMin">phiMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:phiMax">phiMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:lengthMin">lengthMin</a> &gt; 0)    o &lt;&lt; "Track length         = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:lengthMin">lengthMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:lengthMax">lengthMax</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:spanDch">spanDch</a> &gt; 0)      o &lt;&lt; "Layer distance       &gt; " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:spanDch">spanDch</a> &lt;&lt; endl; 
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMin">zMin</a>&gt;-1.E8 || <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMax">zMax</a> &lt; 1.E8) o &lt;&lt; "z position           = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMin">zMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:zMax">zMax</a> &lt;&lt; endl;
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:docaMax">docaMax</a> &lt; 1.E8)    o &lt;&lt; "doca                 = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:docaMax">docaMax</a> &lt;&lt; endl;
    if (<a href=".././TGoodTrackSelector.html#TGoodTrackSelector:emcMin">emcMin</a> &gt; 0)     o &lt;&lt; "Matched EMC energy   = " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:emcMin">emcMin</a> &lt;&lt; " ... " &lt;&lt; <a href=".././TGoodTrackSelector.html#TGoodTrackSelector:emcMax">emcMax</a> &lt;&lt; " GeV" &lt;&lt; endl;
    o &lt;&lt; endl;    
}

std::ostream&amp;  operator &lt;&lt; (std::ostream&amp; o, const <a href=".././TGoodTrackSelector.html">TGoodTrackSelector</a>&amp; a) { a.<a href="#TGoodTrackSelector:PrintOn">PrintOn</a>(o); return o; }


</pre>

<!--SIGNATURE-->
<br>
<hr>
<center>
<address>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</address>
</center>
<hr>
<address>
This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
