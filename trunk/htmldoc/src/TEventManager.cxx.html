<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Fri Dec 20 16:02:51 2002            -->
<!--                                             -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>TEventManager - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, windows, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//                                                                      //</b>
<b>// <a href=".././TEventManager.html">TEventManager</a>							//</b>
<b>//                                                                      //</b>
<b>// Event manager					   		//</b>
<b>//                                                                      //</b>
<b>// Author: Marcel Kunze, Bochum University, March 99			//</b>
<b>// Copyright (C) 1999-2001, Ruhr-University Bochum.			//</b>
<b>//									//</b>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//#define DEBUG</b>

#include &lt;stdlib.h&gt;
#include "RhoBase/TRho.h"
#include "RhoBase/TCandList.h"
#include "RhoBase/VAbsBit.h"
#include "RhoBase/VAbsReader.h"
#include "RhoBase/VAbsWriter.h"
#include "RhoBase/VAbsCollection.h"
#include "RhoManager/TEventManager.h"
#include "RhoManager/TDirectoryManager.h"
#include "RhoManager/TAssociator.h"

#include "RhoBase/TFactory.h"
#include "RhoBase/TEventInfo.h"
#include "RhoBase/TSimpleVertex.h"
#include "RhoConditions/TRhoTime.h"
#include "RhoConditions/TBeams.h"

#include "PAFSchema/PAFReader.h"
<b>//#include "PAFSchema/<a href=".././PAFWriter.html">PAFWriter</a>.h"</b>
#include "KangaSchema/KangaReader.h"

ClassImp(TEventManager)

#include &lt;iostream&gt;
using namespace std;

<b>//----------------</b>
<b>// Constructors --</b>
<b>//----------------</b>

<a name="TEventManager:TEventManager"> </a><a href=".././TEventManager.html#TEventManager:TEventManager">TEventManager::TEventManager</a>() : 
<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>(0),
<a href=".././TEventManager.html#TEventManager:fDirMgr">fDirMgr</a>( 0 ),
<a href=".././TEventManager.html#TEventManager:fDictionary">fDictionary</a>(0),
<a href=".././TEventManager.html#TEventManager:fCounter">fCounter</a>(-1),
<a href=".././TEventManager.html#TEventManager:fTotal">fTotal</a>(0),
<a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a>( kFALSE ),
<a href=".././TEventManager.html#TEventManager:fChange">fChange</a>( kFALSE ),
<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>(0),
<a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>(0),
<a href=".././TEventManager.html#TEventManager:fKanga">fKanga</a>(kFALSE)
{ 
    <a href=".././TEventManager.html#TEventManager:fTagExpr">fTagExpr</a> = TString("");
    <a href=".././TEventManager.html#TEventManager:fBitExpr">fBitExpr</a> = TString("");
}

<b>//--------------</b>
<b>// Destructor --</b>
<b>//--------------</b>
<a name="TEventManager:~TEventManager"> </a><a href=".././TEventManager.html">TEventManager</a>::~<a href=".././TEventManager.html">TEventManager</a>( ) 
{
}

<b>//--------------</b>
<b>// Operations --</b>
<b>//--------------</b>

<a name="TEventManager:GetTime"> </a><a href=".././TRhoTime.html">TRhoTime</a> <a href=".././TEventManager.html#TEventManager:GetTime">TEventManager::GetTime</a>() const 
{
    return <a href=".././TRhoTime.html">TRhoTime</a>(<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMajorID());
}

<b>// _______ Fill TCandLists __________________________________</b>

<a name="TEventManager:Fill"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:Fill">TEventManager::Fill</a>(TCandList *l) 
{
<b>    // Generate charged candidates and fill them into a list</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;Fill(l);
}

<a name="TEventManager:FillCharged"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:FillCharged">TEventManager::FillCharged</a>(TCandList *l) 
{
<b>    // Generate charged candidates and fill them into a list</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillCharged(l);
}

<a name="TEventManager:FillNeutral"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:FillNeutral">TEventManager::FillNeutral</a>(TCandList *l) 
{
<b>    // Generate neutral candidates and fill them into a list</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillNeutral(l);
}

<a name="TEventManager:FillCompositeList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:FillCompositeList">TEventManager::FillCompositeList</a>(TCandList *l,const <a href="../ListOfTypes.html#char">char</a>* listname)
{
    if (listname == 0)
	return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillAllCompositeList(l);
    else
	return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillCompositeList(l,listname);
} 

<a name="TEventManager:FillFromList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:FillFromList">TEventManager::FillFromList</a>(TCandList *l,const <a href="../ListOfTypes.html#char">char</a>* listname)
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillFromList(l,listname);
} 

<b>//-------------------------------------------  TRUTH   -----------------------------</b>

<a name="TEventManager:FillMcTruthList"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:FillMcTruthList">TEventManager::FillMcTruthList</a>(TCandList *l, <a href=".././TAssociator.html">TAssociator</a> *assoc)
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> n = <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;FillMcTruthList(l);
    if (n&gt;0 &amp;&amp; assoc!=0) assoc-&gt;Associate(*l);
    return n;
}



VAbsMicroCandidate&amp; <a href=".././TEventManager.html#TEventManager:operator">TEventManager::operator</a>[](<a href="../ListOfTypes.html#Int_t">Int_t</a> i) const
{
<b>    // Return a handle to the Micro of the i-th track</b>
    
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMicroCandidate(i);
}

<a name="TEventManager:InitRead"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:InitRead">TEventManager::InitRead</a>(const <a href="../ListOfTypes.html#char">char</a>* dir) 
{
<b>    // Open a single database location</b>
    <a href="#TEventManager:SetInputFile">SetInputFile</a>(dir);
}

<a name="TEventManager:InitRead"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:InitRead">TEventManager::InitRead</a>(<a href=".././TDirectoryManager.html">TDirectoryManager</a> *dm) 
{
<b>    // Work with sets of database files using a directory manager</b>
<b>    // This method is for compatibility; new: UseCollection</b>
    <a href=".././TEventManager.html#TEventManager:fDirMgr">fDirMgr</a> = dm;
    <a href="#TEventManager:UseCollection">UseCollection</a>(dm);
}

<a href="../ListOfTypes.html#void">void</a>
<a name="TEventManager:AddEventToCollection"> </a><a href=".././TEventManager.html#TEventManager:AddEventToCollection">TEventManager::AddEventToCollection</a>(VAbsCollection *theColl) 
{
<b>    // Add the event to the collection. Kanga files carry the suffix.</b>
    static const TString suffix("-micro");
    TString name(<a href="#TEventManager:GetCurrentFilename">GetCurrentFilename</a>());
    if (<a href=".././TEventManager.html#TEventManager:fKanga">fKanga</a>) name += suffix;
    
    theColl-&gt;<a href="#TEventManager:Fill">Fill</a>(name,<a href="#TEventManager:GetCurrentIndex">GetCurrentIndex</a>(),<a href="#TEventManager:GetMinorID">GetMinorID</a>(),<a href="#TEventManager:GetMajorID">GetMajorID</a>() );    
}

<a name="TEventManager:PrintOn"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:PrintOn">TEventManager::PrintOn</a>(std::ostream&amp; o) const 
{
<b>    // Dump the contents of the current event</b>
    
    o &lt;&lt; endl;
    o &lt;&lt; "-------------------------------------------------------" &lt;&lt; endl;
    o &lt;&lt; "Event dump for event taken at " &lt;&lt; <a href="#TEventManager:GetTime">GetTime</a>() &lt;&lt; " (GMT)" &lt;&lt; endl;
    
    if (<a href="#TEventManager:Tag">Tag</a>())
	<a href="#TEventManager:GetTag">GetTag</a>().<a href="#TEventManager:PrintOn">PrintOn</a>(o);
    
    if (<a href="#TEventManager:Aod">Aod</a>())
	for (<a href="../ListOfTypes.html#int">int</a> i=0;i&lt;<a href="#TEventManager:GetNumberOfTracks">GetNumberOfTracks</a>();++i) {
	    const VAbsMicroCandidate &amp;cand = <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMicroCandidate(i);
	    cout &lt;&lt; "nCandidate " &lt;&lt; i+1 &lt;&lt; " (Charge:" &lt;&lt; cand.GetCharge() &lt;&lt; ")" &lt;&lt; endl;
	    cand.<a href="#TEventManager:PrintOn">PrintOn</a>(o);
	}
}

<b>// Private conversion functions</b>

<a href="../ListOfTypes.html#UInt_t">UInt_t</a>
<a name="TEventManager:GetCurrentIndex"> </a><a href=".././TEventManager.html#TEventManager:GetCurrentIndex">TEventManager::GetCurrentIndex</a>() 
{
    if (<a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a>) {
	return <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;GetIndex();
    } else {
	return <a href=".././TEventManager.html#TEventManager:fCounter">fCounter</a>;
    }
}

const <a href="../ListOfTypes.html#char">char</a>* 
<a name="TEventManager:GetCurrentFilename"> </a><a href=".././TEventManager.html#TEventManager:GetCurrentFilename">TEventManager::GetCurrentFilename</a>()
{
    const <a href="../ListOfTypes.html#char">char</a> *name;
    
    if (<a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a>) 
    {
	if (<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>==0) return "";
	name = <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;GetFileName();
    } 
    else 
    {
	name = <a href=".././TEventManager.html#TEventManager:fFile">fFile</a>.Data();	
    }
    
    return name;
}

<a name="TEventManager:GetNumberOfEventsProcessed"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfEventsProcessed">TEventManager::GetNumberOfEventsProcessed</a>() const {
<b>    // Return the number of events currently processed</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfEventsProcessed();
}

<a name="TEventManager:GetNumberOfTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfTracks">TEventManager::GetNumberOfTracks</a>() const {
<b>    // Return the total number of tracks in the event</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfTracks();
}

<a name="TEventManager:GetNumberOfChargedTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfChargedTracks">TEventManager::GetNumberOfChargedTracks</a>() const {
<b>    // Return the number of charged tracks in the event</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfChargedTracks();
}

<a name="TEventManager:GetNumberOfNeutralTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfNeutralTracks">TEventManager::GetNumberOfNeutralTracks</a>() const {
<b>    // Return the number of neutral tracks in the event</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfNeutralTracks();
}

<a name="TEventManager:GetRunNumber"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetRunNumber">TEventManager::GetRunNumber</a>() const {
<b>    // Return the actual run number</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetRunNumber();
}

<a name="TEventManager:GetEventNumber"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetEventNumber">TEventManager::GetEventNumber</a>() const {
<b>    // Return the actual event number</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetEventNumber();
}

<a name="TEventManager:GetMajorID"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetMajorID">TEventManager::GetMajorID</a>() const {
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMajorID();
}

<a name="TEventManager:GetMinorID"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetMinorID">TEventManager::GetMinorID</a>() const {
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMinorID();
}


<b>// Access to object handles</b>

<a name="TEventManager:GetHeader"> </a><a href=".././PAFEventBase.html">PAFEventBase</a>&amp; <a href=".././TEventManager.html#TEventManager:GetHeader">TEventManager::GetHeader</a>() const {
<b>    // Return a handle to the event header</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetHeader();
}    

<a name="TEventManager:GetTag"> </a>VAbsTag&amp; <a href=".././TEventManager.html#TEventManager:GetTag">TEventManager::GetTag</a>() const {
<b>    // Return a handle to the TAG</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetTag();
}

<a name="TEventManager:GetBit"> </a>VAbsBit&amp; <a href=".././TEventManager.html#TEventManager:GetBit">TEventManager::GetBit</a>() const {
<b>    // Return a handle to the BIT</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetBit();
}    

<a name="TEventManager:GetEidInfo"> </a><a href=".././EidInfoR.html">EidInfoR</a>&amp; <a href=".././TEventManager.html#TEventManager:GetEidInfo">TEventManager::GetEidInfo</a>() const {
<b>    // Return a handle to the EidInfo</b>
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetEidInfo();
}    

<a name="TEventManager:GetListBase"> </a><a href=".././PAFListBase.html">PAFListBase</a>&amp; <a href=".././TEventManager.html#TEventManager:GetListBase">TEventManager::GetListBase</a>() const {
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetListBase();
}

<a name="TEventManager:Next"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TEventManager.html#TEventManager:Next">TEventManager::Next</a>()
{ 
<b>    // Get the next event either from a file or a collection</b>
    
    if ( <a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a> ) {	// Read a collection
<b>	// Find out next index</b>
	<a href=".././TEventManager.html#TEventManager:fCounter">fCounter</a> = <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;NextIndex(<a href=".././TEventManager.html#TEventManager:fChange">fChange</a>);
	
<b>	// Check, if the file has changed</b>
	if (<a href=".././TEventManager.html#TEventManager:fChange">fChange</a>) {
	    TString newFile = <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;GetFileName();
	    if (newFile.Length()!=0) { // more to do ?
		<a href="#TEventManager:SetInputFile">SetInputFile</a>(newFile);
		<a href=".././TEventManager.html#TEventManager:fChange">fChange</a>=kFALSE;
	    } else {
		return kFALSE;	// EoFs
	    }
	}
	
    }
    
    else
	<a href=".././TEventManager.html#TEventManager:fCounter">fCounter</a>++;   // Read from single file
    
    return (<a href="#TEventManager:GetEvent">GetEvent</a>(<a href=".././TEventManager.html#TEventManager:fCounter">fCounter</a>)!=0);
}

<a name="TEventManager:GetEvent"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TEventManager.html#TEventManager:GetEvent">TEventManager::GetEvent</a>(<a href="../ListOfTypes.html#UInt_t">UInt_t</a> n)
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetEvent(n);
}

<a name="TEventManager:UseCollection"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:UseCollection">TEventManager::UseCollection</a>(VAbsCollection *c)
{
    <a href=".././TEventManager.html#TEventManager:fChange">fChange</a>=kFALSE;
    if (<a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>!=0) { delete <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>; <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>=0; }
    <a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a>=kTRUE;
    <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a> = c;
    c-&gt;<a href="#TEventManager:InitRead">InitRead</a>();
    TString f = c-&gt;GetFileName();
    if (f.Length()!=0) {
	<a href="#TEventManager:SetInputFile">SetInputFile</a>(f);
    }
}

<a name="TEventManager:UseCollection"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:UseCollection">TEventManager::UseCollection</a>(const <a href="../ListOfTypes.html#char">char</a>* filename)
{
    <a href=".././TEventManager.html#TEventManager:fChange">fChange</a>=kFALSE;
    if (<a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>!=0) { delete <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>; <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>=0;}
    <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a> = new TFile(filename);
    if (!<a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>-&gt;IsOpen()) {
	cout &lt;&lt; " *** ERROR in <a href=".././TEventManager.html#TEventManager:UseCollection">TEventManager::UseCollection</a> :";
	cout &lt;&lt; " Cannot open file '" &lt;&lt; filename &lt;&lt; "' " &lt;&lt; endl;
	delete <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>; <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>=0;
	return;
    }
    <a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a> = (VAbsCollection*) <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>-&gt;Get("Collection");
    if (<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>==0) {
	cout &lt;&lt; " *** ERROR in <a href=".././TEventManager.html#TEventManager:UseCollection">TEventManager::UseCollection</a> :";
	cout &lt;&lt; " Collection in " &lt;&lt; filename &lt;&lt; " must have Key 'Collection'" &lt;&lt; endl;
	delete <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>; <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>=0;
	return;
    }
    if (!<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;InitRead()) {
	cout &lt;&lt; " *** ERROR in <a href=".././TEventManager.html#TEventManager:UseCollection">TEventManager::UseCollection</a> :";
	cout &lt;&lt; " Could not initialise Collection in file " &lt;&lt; filename &lt;&lt; endl;
	delete <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>; <a href=".././TEventManager.html#TEventManager:fCollectionFile">fCollectionFile</a>=0;
	return;
    }
    <a href=".././TEventManager.html#TEventManager:fActiveCollection">fActiveCollection</a>=kTRUE; 
    if (TString(<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;GetFileName()).Length()!=0) {
	<a href="#TEventManager:SetInputFile">SetInputFile</a>(<a href=".././TEventManager.html#TEventManager:fCollection">fCollection</a>-&gt;GetFileName());
    }
}

<a name="TEventManager:SetInputFile"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:SetInputFile">TEventManager::SetInputFile</a>(const <a href="../ListOfTypes.html#char">char</a> *filename)
{
    <a href=".././TEventManager.html#TEventManager:fFile">fFile</a> = <a href="#TEventManager:FullyQualified">FullyQualified</a>(filename);	// Note the current file
    
<b>    // Check the mode of operation (Kanga or PAF)</b>
    
    <a href=".././TEventManager.html#TEventManager:fKanga">fKanga</a> = (<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>.Index("Kanga") &gt;= 0);
    if (<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>.Index("-micro")==<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>.Length()-6) {
	<a href=".././TEventManager.html#TEventManager:fFile">fFile</a> = <a href=".././TEventManager.html#TEventManager:fFile">fFile</a>(0,<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>.Length()-6); // Remove the suffix
	<a href=".././TEventManager.html#TEventManager:fKanga">fKanga</a> = kTRUE;
    }
    
    if (<a href=".././TEventManager.html#TEventManager:fReader">fReader</a> != 0) delete <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>; // Get rid of the old reader
    
    if (<a href=".././TEventManager.html#TEventManager:fKanga">fKanga</a>)
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a> = new <a href=".././KangaReader.html">KangaReader</a>(<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>);
    else
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a> = new <a href=".././PAFReader.html">PAFReader</a>(<a href=".././TEventManager.html#TEventManager:fFile">fFile</a>);

<b>    // Activate the streams to process</b>
    <a href=".././TParameterManager.html">TParameterManager</a> *parmgr = TRho::Instance()-&gt;GetParameterManager();
    if (parmgr != 0) {
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetStreamStatus("tag",parmgr-&gt;GetBoolParm("tag"));
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetStreamStatus("aod",parmgr-&gt;GetBoolParm("aod")||parmgr-&gt;GetBoolParm("micro"));
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetStreamStatus("mct",parmgr-&gt;GetBoolParm("mct"));
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetStreamStatus("map",parmgr-&gt;GetBoolParm("map")||parmgr-&gt;GetBoolParm("readMaps"));
	<a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetStreamStatus("cmp",parmgr-&gt;GetBoolParm("cmp")||parmgr-&gt;GetBoolParm("readCmpList"));
    }
    
    <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;InitializeStreams(parmgr-&gt;GetBoolParm("multi")); // Open the file

<b>    // Set the tagcut formula</b>
    <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetBitFormula(<a href=".././TEventManager.html#TEventManager:fBitExpr">fBitExpr</a>);
    <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;SetTagFormula(<a href=".././TEventManager.html#TEventManager:fTagExpr">fTagExpr</a>);
}

<a name="TEventManager:FullyQualified"> </a>TString <a href=".././TEventManager.html#TEventManager:FullyQualified">TEventManager::FullyQualified</a>(TString s)
{
<b>    // Check that we have a fully qualified Unix or Windows filename</b>
    
    if (s.Data()[0] == '/') return s; // UNIX
    if (s.Data()[0] == '$') return s; // Environment
    if (s.Data()[0] == '~') return s; // Home directory
    if (s.Data()[0] == '.') return s; // Absolute path
    if (s.Data()[1] == ':') return s; // Windows drive letter
    if (s.Index("root:")==0) return s; // ROOTD file
    
    s = TString(TRho::Instance()-&gt;GetEventStore())+"/"+s; // Prepend the base directory
    
    return s;
}

<a name="TEventManager:SetTagFormula"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:SetTagFormula">TEventManager::SetTagFormula</a>(const <a href="../ListOfTypes.html#char">char</a>* tagExpr)
{
    <a href=".././TEventManager.html#TEventManager:fTagExpr">fTagExpr</a> = tagExpr;
}

<a name="TEventManager:SetBitFormula"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:SetBitFormula">TEventManager::SetBitFormula</a>(const <a href="../ListOfTypes.html#char">char</a>* tagExpr)
{
    <a href=".././TEventManager.html#TEventManager:fBitExpr">fBitExpr</a> = tagExpr;
}

<a name="TEventManager:EvalBitFormula"> </a><a href="../ListOfTypes.html#Double_t">Double_t</a> <a href=".././TEventManager.html#TEventManager:EvalBitFormula">TEventManager::EvalBitFormula</a>()
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;EvalBitFormula();
}

<a name="TEventManager:EvalTagFormula"> </a><a href="../ListOfTypes.html#Double_t">Double_t</a> <a href=".././TEventManager.html#TEventManager:EvalTagFormula">TEventManager::EvalTagFormula</a>()
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;EvalTagFormula();
}

<a name="TEventManager:GetMicroCandidate"> </a>VAbsMicroCandidate&amp; <a href=".././TEventManager.html#TEventManager:GetMicroCandidate">TEventManager::GetMicroCandidate</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> n) const
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMicroCandidate(n);
}

<a name="TEventManager:GetMcTruth"> </a>VAbsTruth&amp; <a href=".././TEventManager.html#TEventManager:GetMcTruth">TEventManager::GetMcTruth</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> n)
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetMcTruth(n);
}

<a name="TEventManager:GetNumberOfMcTruthTracks"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfMcTruthTracks">TEventManager::GetNumberOfMcTruthTracks</a>() const
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfMcTruthTracks();
}

<a name="TEventManager:GetNumberOfLists"> </a><a href="../ListOfTypes.html#UInt_t">UInt_t</a> <a href=".././TEventManager.html#TEventManager:GetNumberOfLists">TEventManager::GetNumberOfLists</a>()
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetNumberOfLists();
}

<a name="TEventManager:GetListName"> </a>const <a href="../ListOfTypes.html#char">char</a>* <a href=".././TEventManager.html#TEventManager:GetListName">TEventManager::GetListName</a>(<a href="../ListOfTypes.html#Int_t">Int_t</a> i)
{
    return <a href=".././TEventManager.html#TEventManager:fReader">fReader</a>-&gt;GetListName(i);
}

<a name="TEventManager:GetEventInfo"> </a>TEventInfo* <a href=".././TEventManager.html#TEventManager:GetEventInfo">TEventManager::GetEventInfo</a>() const
{
<b>    // Assemble an event info</b>
<b>    // Check the event number and return cache</b>
    static TEventInfo *eventInfo = new TEventInfo; // Generate the event info object
    static <a href="../ListOfTypes.html#int">int</a> oldEvent = -1;
    if (<a href="#TEventManager:GetEventNumber">GetEventNumber</a>() == oldEvent) return eventInfo;
    oldEvent = <a href="#TEventManager:GetEventNumber">GetEventNumber</a>();

    <a href=".././TConditions.html">TConditions</a> *theConditions = TRho::Instance()-&gt;GetConditions();
    theConditions-&gt;At(<a href="#TEventManager:GetMajorID">GetMajorID</a>());	// Read the beam conditions DB

    <a href=".././TBeams.html">TBeams</a> *theBeams = theConditions-&gt;GetBeams();
        
<b>    // First, set the CM frame</b>
    eventInfo-&gt;SetCmFrame(theBeams-&gt;Total4Momentum());
    
<b>    // Second, set the beam spot and its error</b>
    eventInfo-&gt;SetBeamSpot(theBeams-&gt;Interaction3Point());
    
<b>    // Third, set the electron and positron beam</b>
    eventInfo-&gt;SetPepBeams(TCandidate(theBeams-&gt;EMinus4Momentum()),TCandidate(theBeams-&gt;EPlus4Momentum()));
    
<b>    // Set the primary vertex</b>
    TVector3 pv = <a href="#TEventManager:GetTag">GetTag</a>().GetPrimaryVertex();
    static VAbsVertex *vertex = 0;
    if (vertex!=0) delete vertex;
    vertex = new TSimpleVertex(pv);
    eventInfo-&gt;SetPrimaryVertex(vertex);

    return eventInfo;
}

<a name="TEventManager:WriteEvent"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TEventManager.html#TEventManager:WriteEvent">TEventManager::WriteEvent</a>(VAbsWriter *writer, TCandList *list)
{
    writer-&gt;<a href="#TEventManager:WriteEvent">WriteEvent</a>(this,list);
}

<b>// --------------------</b>
<b>// non-member functions</b>
<b>// --------------------</b>

std::ostream&amp;  operator &lt;&lt; (std::ostream&amp; o, const <a href=".././TEventManager.html">TEventManager</a>&amp; a) {a.<a href="#TEventManager:PrintOn">PrintOn</a>(o); return o;}

</pre>

<!--SIGNATURE-->
<br>
<hr>
<center>
<address>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</address>
</center>
<hr>
<address>
This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
