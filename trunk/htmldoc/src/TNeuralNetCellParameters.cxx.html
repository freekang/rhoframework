<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Fri Dec 20 16:03:09 2002            -->
<!--                                             -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>TNeuralNetCellParameters - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, windows, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//									//</b>
<b>// Routines for Connected-Cell-Networks					//</b>
<b>// Part of the Neural Network Objects package (NNO)			//</b>
<b>//									//</b>
<b>// Author List:								//</b>
<b>// Johannes Steffens, Bochum University					//</b>
<b>// M.Kunze, Bochum University						//</b>
<b>// (C) Copyright Johannes Steffens 1995, Ruhr-University Bochum.	//</b>
<b>//									//</b>
<b>//////////////////////////////////////////////////////////////////////////</b>

#include "RhoNNO/TNeuralNetCell.h"
#include "RhoNNO/VNeuralNet.h"

ClassImp(TNeuralNetCellParameters)

<a name="TNeuralNetCellParameters:TNeuralNetCellParameters"> </a>TNeuralNetCellParameters::TNeuralNetCellParameters() 
{
    fWinStep = 0;
    fNeiStep = 0;
    fNeuStep = 0;
    fCells = 0;
    fConnectors = 0;
    fWinCount = 0;
    fMinCells = 0;
    fMaxCells = 0;
    fInsertStep = 0;
    fDeleteStep = 0;
    fInsertCount = 0;
    fDeleteCount = 0;
    fEdgeCount = 0;
    fErrCount = 0;
    fNeiCount = 0;
    fMinCount = 0;
    fMainWinCount = 0;
    fMainErrCount = 0;
    fMainEdgeCount = 0;
}

ClassImp(TNeuralNetCell)

TNeuralNetCell::TNeuralNetCell()
{
    fVector = 0;
    fID = 0;
    fCount = 0;
    fDiff  = 0;
    fState  = 0;
    fC  = 0;
    fNc = 0;
    fChi2 = 0;
    fWeight = 0;
    fOut = 0;
    fAge = 0;
    fClass = 0;
}

void TNeuralNetCell::Disconnect(TNeuralNetCell* up1,TNeuralNetCell* up2) 
{
     int I;
     for (I=0;I&lt;up1-&gt;fNc;++I) if (up1-&gt;fC[I].fPtr==up2) break;
     if (I&lt;up1-&gt;fNc) up1-&gt;fC[I]=up1-&gt;fC[--up1-&gt;fNc];
     for (I=0;I&lt;up2-&gt;fNc;++I) if (up2-&gt;fC[I].fPtr==up1) break;
     if (I&lt;up2-&gt;fNc) up2-&gt;fC[I]=up2-&gt;fC[--up2-&gt;fNc];
}

void TNeuralNetCell::Connect(TNeuralNetCell* up1,TNeuralNetCell* up2,TNeuralNetCellParameters* XB) 
{
     if ((up1-&gt;fNc==XB-&gt;fConnectors)||(up2-&gt;fNc==XB-&gt;fConnectors)) return;
     up1-&gt;fC[up1-&gt;fNc++].fPtr=up2;
     up2-&gt;fC[up2-&gt;fNc++].fPtr=up1;
}

<b>//connect new cell with common neighbours of unit1 and unit2</b>
<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:ConnectNew">TNeuralNetCell::ConnectNew</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit1,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit2,<a href=".././TNeuralNetCellParameters.html">TNeuralNetCellParameters</a>* XB) 
{
    <a href="../ListOfTypes.html#int">int</a> I,J;
    for (I=0;I&lt;unit1-&gt;fNc;++I) 
	for (J=0;J&lt;unit2-&gt;fNc;++J)
	if (unit1-&gt;fC[I].fPtr==unit2-&gt;fC[J].fPtr)
	   Connect((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unit1-&gt;fC[I].fPtr,unew,XB);
    Connect(unew,unit1,XB);
    Connect(unew,unit2,XB);
    Disconnect(unit1,unit2);
}

<b>//this procedure places unew beween all neighbours in the centre of gravity</b>
<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:InitVector">TNeuralNetCell::InitVector</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I,J;
     for (I=0;I&lt;B-&gt;fInNodes;++I) unew-&gt;fVector[I]=0;
     for (J=0;J&lt;unew-&gt;fNc;++J) {
	 <a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unei = (<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*) unew-&gt;fC[J].fPtr;
	 for (I=0;I&lt;B-&gt;fInNodes;++I) 
	     unew-&gt;fVector[I] += unei-&gt;fVector[I];
     }
     for (I=0;I&lt;B-&gt;fInNodes;++I) unew-&gt;fVector[I] /= unew-&gt;fNc;
}

<b>//this procedure places unew beween U1 and U2</b>
<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:InitVector">TNeuralNetCell::InitVector</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* U1,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* U2,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I;
     for (I=0;I&lt;B-&gt;fInNodes;++I) 
	 unew-&gt;fVector[I] = (U1-&gt;fVector[I] + U2-&gt;fVector[I]) * 0.5;
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:InitWgt">TNeuralNetCell::InitWgt</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I,J;
     <a href="../ListOfTypes.html#Double_t">Double_t</a> fract=1.0 / (1.0 + unew-&gt;fNc);
     for (I=0;I&lt;B-&gt;fOutNodes;++I) unew-&gt;fWeight[I]=0;
     for (J=0;J&lt;unew-&gt;fNc;++J) {
	<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unei = (<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*) unew-&gt;fC[J].fPtr;
	for (I=0;I&lt;B-&gt;fOutNodes;++I) {
	    <a href="../ListOfTypes.html#Double_t">Double_t</a> WgtFract = unei-&gt;fWeight[I] * fract;
	    unew-&gt;fWeight[I] += WgtFract;
	    unei-&gt;fWeight[I] -= WgtFract;
	}
     }
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:GetSDev">TNeuralNetCell::GetSDev</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I,J;
     unit-&gt;fChi2=0;
     for (I=0;I&lt;unit-&gt;fNc;++I) {
	<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unei=(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unit-&gt;fC[I].fPtr;
	<a href="../ListOfTypes.html#Double_t">Double_t</a> sdist = 0.0;
	for (J=0;J&lt;B-&gt;fInNodes;++J) { 
	  <a href="../ListOfTypes.html#Double_t">Double_t</a> d = unei-&gt;fVector[J] - unit-&gt;fVector[J]; 
	  sdist += d * d; 
	}
	unit-&gt;fChi2 += sdist;
     }
     unit-&gt;fChi2 /= unit-&gt;fNc;
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:InitSDev">TNeuralNetCell::InitSDev</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I;
     GetSDev(unew,B);
     for (I=0;I&lt;unew-&gt;fNc;++I) GetSDev((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unew-&gt;fC[I].fPtr,B);
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:InitCount">TNeuralNetCell::InitCount</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unew) 
{
    <a href="../ListOfTypes.html#int">int</a> I;
    <a href="../ListOfTypes.html#Double_t">Double_t</a> fract = 1.0 / (<a href="../ListOfTypes.html#Double_t">Double_t</a>) (unew-&gt;fNc+1);
    unew-&gt;fCount=0;
    for (I=0;I&lt;unew-&gt;fNc;++I) {
	<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unei=(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unew-&gt;fC[I].fPtr;
	<a href="../ListOfTypes.html#Double_t">Double_t</a> errFract=((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unew-&gt;fC[I].fPtr)-&gt;fCount * fract;
	unei-&gt;fCount -= errFract;
	unew-&gt;fCount += errFract;
    }
}


<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:CheckConnections">TNeuralNetCell::CheckConnections</a>(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit) 
{
     <a href="../ListOfTypes.html#int">int</a> I,J;
     for (I=0;I&lt;unit-&gt;fNc;++I) {
         <a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unei=(<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unit-&gt;fC[I].fPtr;
	 for (J=0;J&lt;unei-&gt;fNc;++J) {if ((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)unei-&gt;fC[J].fPtr==unit) break; }
	 if (J==unei-&gt;fNc) fprintf(stdout,"one-way-connection from cell %i to cell %i",unit-&gt;fID,unei-&gt;fID);
     }
}


<b>//               -------------  FILE I/O  ----------------</b>

<a href="../ListOfTypes.html#char">char</a> f_id[]          = "nunit number    %in";
<a href="../ListOfTypes.html#char">char</a> f_fChi2[]       = "square deviation %len";
<a href="../ListOfTypes.html#char">char</a> f_count[]       = "count            %len";
<a href="../ListOfTypes.html#char">char</a> f_vector[]      = "vectorn";
<a href="../ListOfTypes.html#char">char</a> f_connections[] = "nconnections %in";
<a href="../ListOfTypes.html#char">char</a> f_con_list[]    = "connected with ";


<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:WriteUnitText">TNeuralNetCell::WriteUnitText</a>(FILE* file,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I;
     fprintf(file,f_id,unit-&gt;fID);
     fprintf(file,f_fChi2,unit-&gt;fChi2);
     fprintf(file,f_count,unit-&gt;fCount);
     fprintf(file,f_vector);
     for (I=0;I&lt;B-&gt;fInNodes;++I) fprintf(file,"%len",unit-&gt;fVector[I]);
     fprintf(file,f_connections,unit-&gt;fNc);
     fprintf(file,f_con_list);
     for (I=0;I&lt;unit-&gt;fNc;++I) fprintf(file,"%i ",((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)(unit-&gt;fC[I].fPtr))-&gt;fID);
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:ReadUnitText">TNeuralNetCell::ReadUnitText</a>(FILE* file,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     <a href="../ListOfTypes.html#int">int</a> I;
     fscanf(file,f_id,&amp;unit-&gt;fID);
     fscanf(file,f_fChi2,&amp;unit-&gt;fChi2);
     fscanf(file,f_count,&amp;unit-&gt;fCount);
     fscanf(file,f_vector);
     for (I=0;I&lt;B-&gt;fInNodes;++I) fscanf(file,"%le",&amp;unit-&gt;fVector[I]);
     fscanf(file,f_connections,&amp;unit-&gt;fNc);
     fscanf(file,f_con_list);
     for (I=0;I&lt;unit-&gt;fNc;++I) fscanf(file,"%i",&amp;unit-&gt;fC[I].fID);
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:WriteUnitBinary">TNeuralNetCell::WriteUnitBinary</a>(FILE* file,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     fwrite(&amp;unit-&gt;fID,sizeof(unit-&gt;fID),1,file);
     fwrite(&amp;unit-&gt;fChi2,sizeof(unit-&gt;fChi2),1,file);
     fwrite(&amp;unit-&gt;fCount,sizeof(unit-&gt;fCount),1,file);
     fwrite(unit-&gt;fVector,sizeof(<a href="../ListOfTypes.html#Double_t">Double_t</a>),B-&gt;fInNodes,file);
     fwrite(&amp;unit-&gt;fNc,sizeof(unit-&gt;fNc),1,file);
     <a href="../ListOfTypes.html#int">int</a> I;
     for (I=0;I&lt;unit-&gt;fNc;++I) {
	 <a href="../ListOfTypes.html#Int_t">Int_t</a> i = ((<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>*)(unit-&gt;fC[I].fPtr))-&gt;fID;
	 fwrite(&amp;i,sizeof(i),1,file);
     }
}

<a href="../ListOfTypes.html#void">void</a> <a href=".././TNeuralNetCell.html#TNeuralNetCell:ReadUnitBinary">TNeuralNetCell::ReadUnitBinary</a>(FILE* file,<a href=".././TNeuralNetCell.html">TNeuralNetCell</a>* unit,<a href=".././TNeuralNetParameters.html">TNeuralNetParameters</a>* B) 
{
     fread(&amp;unit-&gt;fID,sizeof(unit-&gt;fID),1,file);
     fread(&amp;unit-&gt;fChi2,sizeof(unit-&gt;fChi2),1,file);
     fread(&amp;unit-&gt;fCount,sizeof(unit-&gt;fCount),1,file);
     fread(unit-&gt;fVector,sizeof(<a href="../ListOfTypes.html#Double_t">Double_t</a>),B-&gt;fInNodes,file);
     fread(&amp;unit-&gt;fNc,sizeof(unit-&gt;fNc),1,file);
     fread(unit-&gt;fC,sizeof(connector),unit-&gt;fNc,file);
}


</pre>

<!--SIGNATURE-->
<br>
<hr>
<center>
<address>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</address>
</center>
<hr>
<address>
This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
