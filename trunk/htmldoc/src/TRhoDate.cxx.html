<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<!--                                             -->
<!-- Author: ROOT team (rootdev@hpsalo.cern.ch)  -->
<!--                                             -->
<!--   Date: Fri Dec 20 16:03:23 2002            -->
<!--                                             -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>TRhoDate - source file</title>
<link rev=made href="mailto:rootdev@root.cern.ch">
<meta name="rating" content="General">
<meta name="objecttype" content="Manual">
<meta name="keywords" content="software development, oo, object oriented, unix, x11, windows, c++, html, rene brun, fons rademakers">
<meta name="description" content="ROOT - An Object Oriented Framework For Large Scale Data Analysis.">
</head>
<body BGCOLOR="#ffffff" LINK="#0000ff" VLINK="#551a8b" ALINK="#ff0000" TEXT="#000000">
<a name="TopOfPage"></a>
<pre>
<b>//////////////////////////////////////////////////////////////////////////</b>
<b>//                                                                      //</b>
<b>// <a href=".././TRhoDate.html">TRhoDate</a>		    						//</b>
<b>//                                                                      //</b>
<b>// Date and time class				    			//</b>
<b>//                                                                      //</b>
<b>// Author: Marcel Kunze, RUB, Feb. 99					//</b>
<b>// Copyright (C) 1999-2001, Ruhr-University Bochum.			//</b>
<b>//                                                                      //</b>
<b>//////////////////////////////////////////////////////////////////////////</b>

#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;time.h&gt;
#include "RhoConditions/TRhoDate.h"

ClassImp(TRhoDate)

#include &lt;iostream&gt;
using namespace std;

const unsigned char TRhoDate::daysInMonth[12] = {31,28,31,30,31,30,31,31,30,31,30,31};
const unsigned long TRhoDate::firstDayOfEachMonth[12] = {0,31,59,90,120,151,181,212,243,273,304,334};

/***************************************************************************/

<b>// 	constructors</b>

/***************************************************************************/

/*
* Construct a <a href=".././TRhoDate.html">TRhoDate</a> with a given day of the year and a given year.  The
* base date for this computation is Dec. 31 of the previous year.  If
* year == 0, Construct a <a href=".././TRhoDate.html">TRhoDate</a> with Jan. 1, 1901 as the "day zero".
* i.e., <a href=".././TRhoDate.html">TRhoDate</a>(-1) = Dec. 31, 1900 and <a href=".././TRhoDate.html">TRhoDate</a>(1) = Jan. 2, 1901.
*/

<a name="TRhoDate:TRhoDate"> </a><a href=".././TRhoDate.html#TRhoDate:TRhoDate">TRhoDate::TRhoDate</a>(unsigned <a href="../ListOfTypes.html#long">long</a> day, unsigned <a href="../ListOfTypes.html#long">long</a> year) {
    if (year) <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> = <a href="#TRhoDate:Jday">Jday</a>(12, 31, year-1) + (<a href="../ListOfTypes.html#Int_t">Int_t</a>)day;
    else      <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> = Jul1901              + (<a href="../ListOfTypes.html#Int_t">Int_t</a>)day;
}

<b>//   Construct a <a href=".././TRhoDate.html">TRhoDate</a> for the given day, month, and year.</b>
<a name="TRhoDate:TRhoDate"> </a><a href=".././TRhoDate.html#TRhoDate:TRhoDate">TRhoDate::TRhoDate</a>(unsigned <a href="../ListOfTypes.html#long">long</a> day, unsigned <a href="../ListOfTypes.html#long">long</a> month, unsigned <a href="../ListOfTypes.html#long">long</a> year)
{
    <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> = <a href="#TRhoDate:Jday">Jday</a>(month, day, year);
}

/****************************************************************
*								*
*			Member functions 			*
*								*
****************************************************************/

<b>// extract to struct tm components</b>
<a name="TRhoDate:Extract"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TRhoDate.html#TRhoDate:Extract">TRhoDate::Extract</a>(struct tm* tmbuf) const
{
    if (!<a href="#TRhoDate:IsValid">IsValid</a>()) { <a href="#TRhoDate:clobber">clobber</a>(tmbuf); return; }
    unsigned <a href="../ListOfTypes.html#long">long</a> m; unsigned <a href="../ListOfTypes.html#long">long</a> d; unsigned <a href="../ListOfTypes.html#long">long</a> y;
    <a href="#TRhoDate:mdy">mdy</a>(m, d, y);
    tmbuf-&gt;tm_year = y;
    tmbuf-&gt;tm_mon  = m;
    tmbuf-&gt;tm_mday = d;
    tmbuf-&gt;tm_wday = <a href="#TRhoDate:WeekDay">WeekDay</a>() % 7;
    tmbuf-&gt;tm_yday = <a href=".././TRhoDate.html#TRhoDate:firstDayOfEachMonth">firstDayOfEachMonth</a>[m - 1] + (d - 1);
    if (<a href="#TRhoDate:LeapYear">LeapYear</a>(y) &amp;&amp; m &gt; 2)
        ++tmbuf-&gt;tm_yday;
    tmbuf-&gt;tm_hour = tmbuf-&gt;tm_min = tmbuf-&gt;tm_sec = 0;
    tmbuf-&gt;tm_isdst = -1;
}

<b>// Compare function:</b>
<a name="TRhoDate:CompareTo"> </a><a href="../ListOfTypes.html#int">int</a> <a href=".././TRhoDate.html#TRhoDate:CompareTo">TRhoDate::CompareTo</a>(
                   const <a href=".././TRhoDate.html">TRhoDate</a>* d) const
{
    return <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> == d-&gt;<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> ? 0 : (<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> &gt; d-&gt;<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> ? 1 : -1);
}

unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:Day">TRhoDate::Day</a>() const
{
<b>    //Cast is o.k. unless we institute a year of length &gt; 32767 days</b>
    return (unsigned)(<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> - <a href="#TRhoDate:Jday">Jday</a>(12, 31, <a href="#TRhoDate:Year">Year</a>()-1 ));
}

<b>// Returns the day of the month of this <a href=".././TRhoDate.html">TRhoDate</a>.</b>
unsigned <a href="../ListOfTypes.html#long">long</a>  <a href=".././TRhoDate.html#TRhoDate:DayOfMonth">TRhoDate::DayOfMonth</a>() const
{
    unsigned <a href="../ListOfTypes.html#long">long</a> m; unsigned <a href="../ListOfTypes.html#long">long</a> d; unsigned <a href="../ListOfTypes.html#long">long</a> y;
    <a href="#TRhoDate:mdy">mdy</a>(m, d, y);
    return d;
}

<b>// Return the number of the first day of a given month</b>
<b>// Return 0 if "month" is outside of the range 1 through 12, inclusive.</b>
unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:FirstDayOfMonth">TRhoDate::FirstDayOfMonth</a>(unsigned <a href="../ListOfTypes.html#long">long</a> month) const
{
    if ( !<a href="#TRhoDate:assertIndexOfMonth">assertIndexOfMonth</a>(month) ) return 0;
    unsigned <a href="../ListOfTypes.html#long">long</a> firstDay = 1 + <a href=".././TRhoDate.html#TRhoDate:firstDayOfEachMonth">firstDayOfEachMonth</a>[month-1];
    if (month &gt; 2 &amp;&amp; <a href="#TRhoDate:Leap">Leap</a>()) firstDay++;
    return firstDay;
}

<a name="TRhoDate:Max"> </a><a href=".././TRhoDate.html">TRhoDate</a> <a href=".././TRhoDate.html#TRhoDate:Max">TRhoDate::Max</a>(const <a href=".././TRhoDate.html">TRhoDate</a>&amp; dt) const
{
    return dt.<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> &gt; <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> ? dt : *this;
}

<a name="TRhoDate:Min"> </a><a href=".././TRhoDate.html">TRhoDate</a> <a href=".././TRhoDate.html#TRhoDate:Min">TRhoDate::Min</a>(const <a href=".././TRhoDate.html">TRhoDate</a>&amp; dt) const 
{
    return dt.<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> &lt; <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> ? dt : *this;
}

<b>// Returns the month of this <a href=".././TRhoDate.html">TRhoDate</a>.</b>
unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:Month">TRhoDate::Month</a>() const
{
    unsigned <a href="../ListOfTypes.html#long">long</a> m; unsigned <a href="../ListOfTypes.html#long">long</a> d; unsigned <a href="../ListOfTypes.html#long">long</a> y;
    <a href="#TRhoDate:mdy">mdy</a>(m, d, y);
    return m;
}

<a name="TRhoDate:Next"> </a><a href=".././TRhoDate.html">TRhoDate</a> <a href=".././TRhoDate.html#TRhoDate:Next">TRhoDate::Next</a>(unsigned <a href="../ListOfTypes.html#long">long</a> desiredDayOfWeek) const
{
    unsigned <a href="../ListOfTypes.html#long">long</a> delta = (desiredDayOfWeek + 6 - <a href="#TRhoDate:WeekDay">WeekDay</a>()) % 7 + 1;
    return <a href=".././TRhoDate.html">TRhoDate</a>(<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> + delta);
}

<a name="TRhoDate:Previous"> </a><a href=".././TRhoDate.html">TRhoDate</a> <a href=".././TRhoDate.html#TRhoDate:Previous">TRhoDate::Previous</a>(unsigned <a href="../ListOfTypes.html#long">long</a> desiredDayOfWeek) const
{
    unsigned <a href="../ListOfTypes.html#long">long</a> delta = (<a href="#TRhoDate:WeekDay">WeekDay</a>() + 6 - desiredDayOfWeek) % 7 + 1;
    return <a href=".././TRhoDate.html">TRhoDate</a>(<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> - delta);
}

unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:WeekDay">TRhoDate::WeekDay</a>() const
{
    return (unsigned)(<a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> % 7 + 1);
}

<b>// Returns the year of this <a href=".././TRhoDate.html">TRhoDate</a>.</b>
unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:Year">TRhoDate::Year</a>() const
{
    unsigned <a href="../ListOfTypes.html#long">long</a> m; unsigned <a href="../ListOfTypes.html#long">long</a> d; unsigned <a href="../ListOfTypes.html#long">long</a> y;
    <a href="#TRhoDate:mdy">mdy</a>(m, d, y);
    return y;
}

/***************************************************************************/

<b>// 			static member functions</b>

/***************************************************************************/

<b>// Is a day (1-31) within a given month?</b>
<a name="TRhoDate:DayWithinMonth"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TRhoDate.html#TRhoDate:DayWithinMonth">TRhoDate::DayWithinMonth</a>(unsigned <a href="../ListOfTypes.html#long">long</a> month, unsigned <a href="../ListOfTypes.html#long">long</a> day, unsigned <a href="../ListOfTypes.html#long">long</a> year)
{
    if (day &lt;= 0 || !<a href="#TRhoDate:assertIndexOfMonth">assertIndexOfMonth</a>(month) ) return kFALSE;
    unsigned <a href="../ListOfTypes.html#long">long</a> d = <a href=".././TRhoDate.html#TRhoDate:daysInMonth">daysInMonth</a>[month-1];
    if (<a href="#TRhoDate:LeapYear">LeapYear</a>(year) &amp;&amp; month == 2) d++;
    return day &lt;= d;
}

<b>// How many days in a given month?</b>
unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:DaysInMonthYear">TRhoDate::DaysInMonthYear</a>(unsigned <a href="../ListOfTypes.html#long">long</a> month, unsigned <a href="../ListOfTypes.html#long">long</a> year)
{
    if (!<a href="#TRhoDate:assertIndexOfMonth">assertIndexOfMonth</a>(month) ) return 0;
    unsigned <a href="../ListOfTypes.html#long">long</a> d = <a href=".././TRhoDate.html#TRhoDate:daysInMonth">daysInMonth</a>[month-1];
    if (<a href="#TRhoDate:LeapYear">LeapYear</a>(year) &amp;&amp; month == 2) d++;
    return d;
}

<b>// How many days are in the given year?</b>
unsigned <a href="../ListOfTypes.html#long">long</a> <a href=".././TRhoDate.html#TRhoDate:DaysInYear">TRhoDate::DaysInYear</a>(unsigned <a href="../ListOfTypes.html#long">long</a> year)
{
    return <a href="#TRhoDate:LeapYear">LeapYear</a>(year) ? 366 : 365;
}

/*
* Convert Gregorian calendar date to the corresponding Julian day
* number j.  Algorithm 199 from Communications of the ACM, Volume 6, No.
* 8, (Aug. 1963), p. 444.  Gregorian calendar started on Sep. 14, 1752.
* This function not valid before that.
* Returns 0 if the date is invalid.
*/

<a name="TRhoDate:Jday"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TRhoDate.html#TRhoDate:Jday">TRhoDate::Jday</a>(unsigned <a href="../ListOfTypes.html#long">long</a> m, unsigned <a href="../ListOfTypes.html#long">long</a> d, unsigned <a href="../ListOfTypes.html#long">long</a> y)
{
    if(y &lt; 100 ) y += 1900; // y is unsigned so always &gt;= 0

    unsigned yh = y;
    <a href="../ListOfTypes.html#Int_t">Int_t</a> c, ya, j;
    if( !<a href="#TRhoDate:DayWithinMonth">DayWithinMonth</a>(m, d, y) ) return (<a href="../ListOfTypes.html#Int_t">Int_t</a>)0;
    
    if (m &gt; 2) { m -= 3; }  // wash out the leap day
    else       { m += 9;	y--; } 
    c = y / 100;
    ya = y - 100*c;
    j = ((146097*c)&gt;&gt;2) + ((1461*ya)&gt;&gt;2) + (153*m + 2)/5 + d + 1721119;
    if (<a href=".././TRhoDate.html">TRhoDate</a>(j).<a href="#TRhoDate:Year">Year</a>() != yh) return 0;
    return j;
} 

<b>// Return today's date:</b>
<a name="TRhoDate:Now"> </a><a href=".././TRhoDate.html">TRhoDate</a> <a href=".././TRhoDate.html#TRhoDate:Now">TRhoDate::Now</a>()
{
    return <a href=".././TRhoDate.html">TRhoDate</a>(<a href=".././TRhoDate.html#TRhoDate:currentDate">TRhoDate::currentDate</a>());
}

<a name="TRhoDate:PrintOn"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TRhoDate.html#TRhoDate:PrintOn">TRhoDate::PrintOn</a>(std::ostream&amp; o) const
{
    struct tm tmbuf;
    <a href="#TRhoDate:Extract">Extract</a>(&amp;tmbuf);
    o &lt;&lt; tmbuf.tm_mon;
    o &lt;&lt; "/";
    o &lt;&lt; tmbuf.tm_mday;
    o &lt;&lt; "/";
    o &lt;&lt; tmbuf.tm_year;
    o &lt;&lt; " ";
}


<b>// --------------------</b>
<b>// non-member functions</b>
<b>// --------------------</b>

std::ostream&amp;  operator &lt;&lt; (std::ostream&amp; o, const <a href=".././TRhoDate.html">TRhoDate</a>&amp; a) {a.<a href="#TRhoDate:PrintOn">PrintOn</a>(o); return o;}

/***********************************************************************
*                                                                     *
*                      Private functions                              *
*                                                                     *
***********************************************************************/
/*
* Convert a Julian day number to its corresponding Gregorian calendar
* date.  Algorithm 199 from Communications of the ACM, Volume 6, No. 8,
* (Aug. 1963), p. 444.  Gregorian calendar started on Sep. 14, 1752.
* This function not valid before that.  
*/

<a name="TRhoDate:mdy"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TRhoDate.html#TRhoDate:mdy">TRhoDate::mdy</a>(unsigned <a href="../ListOfTypes.html#long">long</a>&amp; m, unsigned <a href="../ListOfTypes.html#long">long</a>&amp; D, unsigned <a href="../ListOfTypes.html#long">long</a>&amp; y) const
{
    <a href="../ListOfTypes.html#Int_t">Int_t</a> d;
    <a href="../ListOfTypes.html#Int_t">Int_t</a> j = <a href=".././TRhoDate.html#TRhoDate:julnum">julnum</a> - 1721119;
    y = (unsigned <a href="../ListOfTypes.html#long">long</a>) (((j&lt;&lt;2) - 1) / 146097);
    j = (j&lt;&lt;2) - 1 - 146097*y;
    d = (j&gt;&gt;2);
    j = ((d&lt;&lt;2) + 3) / 1461;
    d = (d&lt;&lt;2) + 3 - 1461*j;
    d = (d + 4)&gt;&gt;2;
    m = (unsigned <a href="../ListOfTypes.html#long">long</a>)(5*d - 3)/153;
    d = 5*d - 3 - 153*m;
    D = (unsigned <a href="../ListOfTypes.html#long">long</a>)((d + 5)/5);
    y = (unsigned <a href="../ListOfTypes.html#long">long</a>)(100*y + j);
    if (m &lt; 10)
        m += 3;
    else {
        m -= 9;
        y++;
    } 
} 

<a name="TRhoDate:currentDate"> </a><a href="../ListOfTypes.html#Int_t">Int_t</a> <a href=".././TRhoDate.html#TRhoDate:currentDate">TRhoDate::currentDate</a>()
{
    <a href="../ListOfTypes.html#time_t">time_t</a> clk = time(0);
    struct tm t;
    t = *localtime(&amp;clk);
    return <a href="#TRhoDate:Jday">Jday</a>(t.tm_mon+1, t.tm_mday, t.tm_year+1900);
}

<b>// Algorithm from K &amp; R, "The C Programming Language", 1st ed.</b>
<a name="TRhoDate:LeapYear"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TRhoDate.html#TRhoDate:LeapYear">TRhoDate::LeapYear</a>(unsigned <a href="../ListOfTypes.html#long">long</a> year)
{
    return (year&amp;3) == 0 &amp;&amp; (year % 100 != 0 || year % 400 == 0);
    
    /* (year&amp;3) is equivalent to (year % 4) */
}

<a name="TRhoDate:Leap"> </a><a href="../ListOfTypes.html#Bool_t">Bool_t</a> <a href=".././TRhoDate.html#TRhoDate:Leap">TRhoDate::Leap</a>() const { return <a href="#TRhoDate:LeapYear">LeapYear</a>(<a href="#TRhoDate:Year">Year</a>());} 

<a name="TRhoDate:clobber"> </a><a href="../ListOfTypes.html#void">void</a> <a href=".././TRhoDate.html#TRhoDate:clobber">TRhoDate::clobber</a>(struct tm* tmbuf)
{
    tmbuf-&gt;tm_year = tmbuf-&gt;tm_mon = tmbuf-&gt;tm_mday = tmbuf-&gt;tm_wday =
        tmbuf-&gt;tm_yday = tmbuf-&gt;tm_hour = tmbuf-&gt;tm_min = tmbuf-&gt;tm_sec =
        tmbuf-&gt;tm_isdst = ~(~0u&gt;&gt;1);
}
</pre>

<!--SIGNATURE-->
<br>
<hr>
<center>
<address>
<a href="http://root.cern.ch/root/Welcome.html">ROOT page</a> - <a href="../ClassIndex.html">Class index</a> - <a href="#TopOfPage">Top of the page</a><br>
</address>
</center>
<hr>
<address>
This page has been automatically generated. If you have any comments or suggestions about the page layout send a mail to <a href="mailto:rootdev@root.cern.ch">ROOT support</a>, or contact <a href="mailto:rootdev@root.cern.ch">the developers</a> with any questions or problems regarding ROOT.
</address>
</body>
</html>
